import{b as f}from"./chunk-K3XQKY74.js";import{a as p,b as h,bb as u,db as c,k as n,v as g,z as m}from"./chunk-T4RMSDZY.js";var d=class l{http=m(c);apiUrl=f.apiUrl;createPatient(t){let e={fullName:t.fullName||`${t.firstName||""} ${t.lastName||""}`.trim(),dateOfBirth:t.dateOfBirth||t.birthDate,gender:t.gender,guardianName:t.guardianName,phoneNumber:t.phoneNumber||t.guardianPhone,address:t.address||t.village||""};return t.facilityId&&(e.facilityId=t.facilityId),this.http.post(`${this.apiUrl}/patients`,e).pipe(n(a=>this.mapBackendToFrontend(a)))}searchPatients(t,e){let a=new u;return t&&t.trim()&&(a=a.set("q",t.trim())),e&&(a=a.set("facilityId",e)),this.http.get(`${this.apiUrl}/patients/search`,{params:a}).pipe(n(r=>{if(Array.isArray(r))return{patients:r.map(s=>this.mapBackendToFrontend(s)),total:r.length};let i=r;return{patients:(i.patients||[]).map(s=>this.mapBackendToFrontend(s)),total:i.total||0}}))}getPatientById(t){return this.http.get(`${this.apiUrl}/patients/${t}`).pipe(n(e=>{let a=this.mapBackendToFrontend(e);return h(p({},a),{age:e.age||this.calculateAge(e.dateOfBirth||e.birthDate),vaccinationHistory:e.vaccinationHistory||[],upcomingAppointments:e.upcomingAppointments||[]})}))}mapBackendToFrontend(t){let e=t.fullName||"",a=e.split(" ").filter(i=>i.length>0),r=String(t.id||t.patientId||"");return{id:r,patientId:t.patientId||r,fullName:e,firstName:a[0]||"",lastName:a.slice(1).join(" ")||"",dateOfBirth:t.dateOfBirth,birthDate:t.dateOfBirth||t.birthDate,gender:t.gender||"MALE",guardianName:t.guardianName||"",phoneNumber:t.phoneNumber,guardianPhone:t.phoneNumber||t.guardianPhone,village:t.village||t.address||"",address:t.address||t.village||"",facilityId:t.facilityId,age:t.age||this.calculateAge(t.dateOfBirth||t.birthDate),createdAt:t.createdAt||new Date().toISOString()}}calculateAge(t){if(!t)return 0;try{let e=new Date(t),a=new Date,r=a.getFullYear()-e.getFullYear(),i=a.getMonth()-e.getMonth();return(i<0||i===0&&a.getDate()<e.getDate())&&r--,r}catch{return 0}}getPatientVaccinations(t){return this.http.get(`${this.apiUrl}/patients/${t}/vaccinations`).pipe()}updatePatient(t,e){return this.http.put(`${this.apiUrl}/patients/${t}`,e)}getPatientsByFacility(t){return this.http.get(`${this.apiUrl}/patients/facility/${t}`).pipe(n(e=>e.map(a=>this.mapBackendToFrontend(a))))}getPatientsCountByFacility(t,e,a){return this.getPatientsByFacility(t).pipe(n(r=>{if(!e&&!a)return r.length;let i=e?new Date(e):new Date(0),s=a?new Date(a):new Date;return r.filter(y=>{let o=new Date(y.createdAt||0);return o>=i&&o<=s}).length}))}static \u0275fac=function(e){return new(e||l)};static \u0275prov=g({token:l,factory:l.\u0275fac,providedIn:"root"})};export{d as a};
