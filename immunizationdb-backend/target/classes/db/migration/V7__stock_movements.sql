-- Create Stock Movements Table
CREATE TABLE IF NOT EXISTS stock_movements
(
    id              BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    facility_id     VARCHAR(50) NOT NULL,
    vaccine_id      VARCHAR(100) NOT NULL, -- Vaccine name or ID
    batch_number    VARCHAR(50) NOT NULL,
    movement_type   VARCHAR(20) NOT NULL, -- 'RECEIVED', 'USED', 'ADJUSTED', 'DAMAGED', 'EXPIRED'
    quantity        INTEGER NOT NULL,
    reason          TEXT,
    created_by      BIGINT NOT NULL,
    created_at      TIMESTAMP WITHOUT TIME ZONE NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT fk_stock_movement_user FOREIGN KEY (created_by) REFERENCES users(id) ON DELETE RESTRICT
);

-- Create indexes for stock_movements
CREATE INDEX IF NOT EXISTS idx_stock_movement_facility ON stock_movements(facility_id);
CREATE INDEX IF NOT EXISTS idx_stock_movement_vaccine ON stock_movements(vaccine_id);
CREATE INDEX IF NOT EXISTS idx_stock_movement_batch ON stock_movements(batch_number);
CREATE INDEX IF NOT EXISTS idx_stock_movement_type ON stock_movements(movement_type);
CREATE INDEX IF NOT EXISTS idx_stock_movement_created_at ON stock_movements(created_at);

