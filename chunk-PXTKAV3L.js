import{b as d}from"./chunk-WNEPFQ7C.js";import{bb as c,db as m,k as r,v as p,z as o}from"./chunk-T4RMSDZY.js";var l=class s{http=o(m);apiUrl=d.apiUrl;getStockLevels(i){let a=new c;return i&&(a=a.set("facility_id",i)),this.http.get(`${this.apiUrl}/api/v1/stock`,{params:a}).pipe(r(n=>n.map(t=>({vaccineId:t.vaccineId||"",vaccineName:t.vaccineName||"",vaccineCode:t.vaccineId||"",currentQuantity:t.currentQuantity||0,totalQuantity:t.currentQuantity||0,oldestExpiryDate:t.oldestExpiryDate||"",status:t.status||"GOOD",batches:[]}))))}receiveStock(i){return this.http.post(`${this.apiUrl}/api/v1/stock/receive`,i)}adjustStock(i){return this.http.post(`${this.apiUrl}/api/v1/stock/adjust`,i)}getStockMovements(i,a,n){let t=new c;return i&&(t=t.set("facility_id",i)),a&&(t=t.set("start_date",a)),n&&(t=t.set("end_date",n)),this.http.get(`${this.apiUrl}/api/inventory/stock/movements`,{params:t})}getBatchesByVaccine(i,a){if(a){let n=encodeURIComponent(i);return console.log("Loading batches for vaccine:",i,"encoded:",n,"facilityId:",a),this.http.get(`${this.apiUrl}/api/inventory/batches/available/${a}/vaccine/${n}`).pipe(r(t=>(console.log(`Received ${t.length} batches from backend for vaccine: ${i}`),t.map(e=>({id:String(e.id||""),vaccineId:String(e.vaccineId||e.vaccine_id||i),vaccineName:e.vaccineName||e.vaccine_name||"",batchNumber:e.batchNumber||e.batch_number||"",quantity:e.quantityRemaining||e.quantity_remaining||0,expiryDate:e.expiryDate||e.expiry_date||"",receivedDate:e.expiryDate||e.expiry_date||"",facilityId:String(e.facilityId||e.facility_id||a),isDepleted:e.isDepleted||e.is_depleted||!1})))))}else{let n=new c().set("vaccine_name",i);return this.http.get(`${this.apiUrl}/api/inventory/batches`,{params:n}).pipe(r(t=>t.map(e=>({id:String(e.id||""),vaccineId:String(e.vaccineId||e.vaccine_id||i),vaccineName:e.vaccineName||e.vaccine_name||"",batchNumber:e.batchNumber||e.batch_number||"",quantity:e.quantityRemaining||e.quantity_remaining||0,expiryDate:e.expiryDate||e.expiry_date||"",receivedDate:e.expiryDate||e.expiry_date||"",facilityId:String(e.facilityId||e.facility_id||""),isDepleted:e.isDepleted||e.is_depleted||!1}))))}}getExpiringBatches(i,a=30){let n=new c().set("days",a.toString());return i&&(n=n.set("facilityId",i)),this.http.get(`${this.apiUrl}/api/inventory/batches/expiring`,{params:n}).pipe(r(t=>t.map(e=>({id:String(e.id||""),vaccineId:String(e.vaccineId||e.vaccine_id||""),vaccineName:e.vaccineName||e.vaccine_name||"",batchNumber:e.batchNumber||e.batch_number||"",quantity:e.quantityRemaining||e.quantity_remaining||0,expiryDate:e.expiryDate||e.expiry_date||"",receivedDate:e.expiryDate||e.expiry_date||"",facilityId:String(e.facilityId||e.facility_id||""),isDepleted:e.isDepleted||e.is_depleted||!1}))))}static \u0275fac=function(a){return new(a||s)};static \u0275prov=p({token:s,factory:s.\u0275fac,providedIn:"root"})};export{l as a};
