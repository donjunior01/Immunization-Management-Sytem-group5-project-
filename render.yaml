services:
  # PostgreSQL Database
  - type: pgsql
    name: immunizationdb
    plan: starter
    databaseName: immunizationdb
    user: root
    ipAllowList: []  # Allow connections from anywhere (or specify IPs)

  # Backend Service
  - type: web
    name: immunizationdb-backend
    env: docker
    dockerfilePath: ./immunizationdb-backend/Dockerfile
    dockerContext: ./immunizationdb-backend
    plan: starter
    envVars:
      - key: SPRING_DATASOURCE_URL
        fromDatabase:
          name: immunizationdb
          property: connectionString
      - key: SPRING_DATASOURCE_USERNAME
        fromDatabase:
          name: immunizationdb
          property: user
      - key: SPRING_DATASOURCE_PASSWORD
        fromDatabase:
          name: immunizationdb
          property: password
      - key: SPRING_JPA_HIBERNATE_DDL_AUTO
        value: update
      - key: SPRING_FLYWAY_ENABLED
        value: "true"
      - key: SPRING_FLYWAY_BASELINE_ON_MIGRATE
        value: "true"
      - key: JWT_SECRET
        sync: false
        generateValue: true
      - key: AFRICASTALKING_API_KEY
        sync: false
      - key: AFRICASTALKING_USERNAME
        value: sandbox
      - key: AFRICASTALKING_SENDER_ID
        value: ImmunizationDB
      - key: SMS_ENABLED
        value: "true"
      - key: SPRING_PROFILES_ACTIVE
        value: production

  # Frontend Service
  - type: web
    name: immunizationdb-frontend
    env: docker
    dockerfilePath: ./immunizationdatabase-frontend/vaxtrack-web/Dockerfile
    dockerContext: ./immunizationdatabase-frontend/vaxtrack-web
    plan: starter
    envVars:
      # Note: Set API_URL manually in Render dashboard after backend is deployed
      # Format: https://your-backend-service.onrender.com/api
      - key: API_URL
        value: https://immunizationdb-backend.onrender.com/api

