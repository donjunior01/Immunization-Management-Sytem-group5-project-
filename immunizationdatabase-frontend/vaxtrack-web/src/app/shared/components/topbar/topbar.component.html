<header class="topbar">
  <div class="topbar-left">
    <button class="sidebar-toggle" (click)="onToggleSidebar()" title="Toggle Sidebar">
      <span class="menu-icon">‚ò∞</span>
    </button>
    <a [routerLink]="['/']" class="topbar-logo">
      <span class="logo-icon">üíâ</span>
      <span class="logo-text">VaxTrack</span>
    </a>
  </div>

  <div class="topbar-right">
    <div class="notification-container" (click)="$event.stopPropagation()">
      <button class="notification-btn" (click)="onToggleNotifications($event)" [title]="'Notifications (' + notificationCount + ')'">
        <span class="notification-icon">üîî</span>
        <span class="notification-badge" *ngIf="notificationCount > 0">{{ notificationCount > 99 ? '99+' : notificationCount }}</span>
      </button>
      <div class="notifications-dropdown" *ngIf="showNotificationsDropdown" (click)="$event.stopPropagation()">
        <div class="dropdown-header">
          <h4>Notifications</h4>
          <div class="header-actions">
            <button class="mark-all-read" (click)="markAllAsRead()">Mark all as read</button>
            <button class="close-dropdown" (click)="closeNotifications()" title="Close">√ó</button>
          </div>
        </div>
        <div class="notifications-list">
          <div *ngIf="notifications.length === 0" class="empty-notifications">
            <span class="empty-icon">üì≠</span>
            <p>No notifications</p>
          </div>
          <div 
            *ngFor="let notification of notifications" 
            class="notification-item"
            [class.unread]="!notification.read"
            [class.alert-error]="notification.type === 'error'"
            [class.alert-warning]="notification.type === 'warning'"
            [class.alert-info]="notification.type === 'info'"
            (click)="markNotificationAsRead(notification)">
            <div class="notification-icon-small">
              {{ notification.type === 'error' ? 'üî¥' : notification.type === 'warning' ? 'üü°' : 'üîµ' }}
            </div>
            <div class="notification-content">
              <div class="notification-title">{{ notification.title }}</div>
              <div class="notification-time">{{ notification.time }}</div>
            </div>
          </div>
        </div>
        <div class="dropdown-footer">
          <button class="view-all-btn" (click)="navigateToAlerts()">View all notifications</button>
        </div>
      </div>
    </div>

    <div class="profile-container" (click)="$event.stopPropagation()">
      <button class="profile-btn" (click)="onProfileClick($event)">
        <div class="profile-avatar">{{ getUserInitials() }}</div>
        <div class="profile-info" *ngIf="currentUser">
          <div class="profile-name">{{ getUserDisplayName() }}</div>
          <div class="profile-role">{{ getUserRole() }}</div>
        </div>
        <span class="profile-arrow">‚ñº</span>
      </button>
      <div class="profile-dropdown" *ngIf="showProfileDropdown" (click)="$event.stopPropagation()">
        <div class="dropdown-user-info">
          <div class="profile-avatar-large">{{ getUserInitials() }}</div>
          <div class="user-details">
            <div class="user-name">{{ getUserDisplayName() }}</div>
            <div class="user-role">{{ getUserRole() }}</div>
            <div class="user-facility" *ngIf="currentUser?.facilityName">{{ currentUser?.facilityName }}</div>
          </div>
          <button class="close-dropdown" (click)="closeProfile()" title="Close">√ó</button>
        </div>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item" (click)="navigateToProfile()">
          <span class="dropdown-icon">üë§</span>
          <span>My Dashboard</span>
        </button>
        <button class="dropdown-item" (click)="navigateToSettings()">
          <span class="dropdown-icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </button>
        <button class="dropdown-item" (click)="navigateToHelp()">
          <span class="dropdown-icon">‚ùì</span>
          <span>Help & Documentation</span>
        </button>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item logout-item" (click)="logout()">
          <span class="dropdown-icon">üö™</span>
          <span>Logout</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showLogoutConfirm" (click)="cancelLogout()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon warning">‚ö†Ô∏è</div>
        <h2>Confirm Logout</h2>
        <button class="modal-close" (click)="cancelLogout()">√ó</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to logout? You will need to login again to access the system.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelLogout()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="confirmLogout()">Logout</button>
      </div>
    </div>
  </div>
</header>
