<header class="topbar">
  <div class="topbar-left">
    <button class="sidebar-toggle" (click)="onToggleSidebar()" title="Toggle Sidebar">
      <span class="menu-icon">‚ò∞</span>
    </button>
    <a [routerLink]="['/']" class="topbar-logo">
      <span class="logo-icon">üíâ</span>
      <span class="logo-text">VaxTrack</span>
    </a>
  </div>

  <div class="topbar-center">
    <div class="search-container">
      <span class="search-icon">üîç</span>
      <input
        type="text"
        class="search-input"
        placeholder="Search patients by name, ID, or phone..."
        [(ngModel)]="searchQuery"
        (input)="onSearch($event)"
        (focus)="showRecentSearches = true"
        (blur)="hideRecentSearches()">
      <div class="recent-searches" *ngIf="recentSearches.length > 0 && showRecentSearches">
        <div class="recent-search-item" *ngFor="let search of recentSearches" (click)="searchQuery = search">
          {{ search }}
        </div>
      </div>
    </div>
  </div>

  <div class="topbar-right">
    <div class="notification-container">
      <button class="notification-btn" (click)="onToggleNotifications()" [title]="'Notifications (' + notificationCount + ')'">
        <span class="notification-icon">üîî</span>
        <span class="notification-badge" *ngIf="notificationCount > 0">{{ notificationCount > 99 ? '99+' : notificationCount }}</span>
      </button>
      <div class="notifications-dropdown" *ngIf="showNotificationsDropdown">
        <div class="dropdown-header">
          <h4>Notifications</h4>
          <div class="header-actions">
            <button class="mark-all-read">Mark all as read</button>
            <button class="close-dropdown" (click)="closeNotifications()" title="Close">√ó</button>
          </div>
        </div>
        <div class="notifications-list">
          <div class="notification-item">
            <div class="notification-icon-small">üî¥</div>
            <div class="notification-content">
              <div class="notification-title">Measles vaccine out of stock</div>
              <div class="notification-time">2 hours ago</div>
            </div>
          </div>
          <div class="notification-item">
            <div class="notification-icon-small">üü°</div>
            <div class="notification-content">
              <div class="notification-title">Penta stock below reorder point</div>
              <div class="notification-time">5 hours ago</div>
            </div>
          </div>
          <div class="notification-item">
            <div class="notification-icon-small">‚ö†Ô∏è</div>
            <div class="notification-content">
              <div class="notification-title">OPV batch expiring in 14 days</div>
              <div class="notification-time">Yesterday</div>
            </div>
          </div>
        </div>
        <div class="dropdown-footer">
          <a [routerLink]="['/manager/alerts']" (click)="closeNotifications()">View all notifications</a>
        </div>
      </div>
    </div>

    <div class="profile-container">
      <button class="profile-btn" (click)="onProfileClick()">
        <div class="profile-avatar">{{ getUserInitials() }}</div>
        <div class="profile-info" *ngIf="currentUser">
          <div class="profile-name">{{ getUserDisplayName() }}</div>
          <div class="profile-role">{{ getUserRole() }}</div>
        </div>
        <span class="profile-arrow">‚ñº</span>
      </button>
      <div class="profile-dropdown" *ngIf="showProfileDropdown">
        <div class="dropdown-user-info">
          <div class="profile-avatar-large">{{ getUserInitials() }}</div>
          <div class="user-details">
            <div class="user-name">{{ getUserDisplayName() }}</div>
            <div class="user-role">{{ getUserRole() }}</div>
            <div class="user-facility" *ngIf="currentUser?.facilityName">{{ currentUser?.facilityName }}</div>
          </div>
          <button class="close-dropdown" (click)="closeProfile()" title="Close">√ó</button>
        </div>
        <div class="dropdown-divider"></div>
        <a [routerLink]="['/profile']" class="dropdown-item" (click)="closeDropdowns()">
          <span class="dropdown-icon">üë§</span>
          <span>My Profile</span>
        </a>
        <a [routerLink]="['/settings']" class="dropdown-item" (click)="closeDropdowns()">
          <span class="dropdown-icon">‚öôÔ∏è</span>
          <span>Settings</span>
        </a>
        <a [routerLink]="['/help']" class="dropdown-item" (click)="closeDropdowns()">
          <span class="dropdown-icon">‚ùì</span>
          <span>Help & Documentation</span>
        </a>
        <div class="dropdown-divider"></div>
        <button class="dropdown-item logout-item" (click)="logout()">
          <span class="dropdown-icon">üö™</span>
          <span>Logout</span>
        </button>
      </div>
    </div>
  </div>

  <!-- Logout Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showLogoutConfirm" (click)="cancelLogout()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <div class="modal-icon warning">‚ö†Ô∏è</div>
        <h2>Confirm Logout</h2>
        <button class="modal-close" (click)="cancelLogout()">√ó</button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to logout? You will need to login again to access the system.</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="cancelLogout()">Cancel</button>
        <button type="button" class="btn btn-primary" (click)="confirmLogout()">Logout</button>
      </div>
    </div>
  </div>
</header>

