<app-layout>
  <div class="admin-users">
    <div class="page-header">
      <div>
        <h1>User Management</h1>
        <p class="subtitle">Manage system users and their access</p>
      </div>
      <button class="btn btn-primary" (click)="openCreateForm()">+ Add User</button>
    </div>

    <app-alert 
      *ngIf="errorMessage" 
      type="error" 
      [message]="errorMessage"
      [show]="!!errorMessage"
      (dismiss)="errorMessage = ''">
    </app-alert>

    <app-alert 
      *ngIf="successMessage" 
      type="success" 
      [message]="successMessage"
      [show]="!!successMessage"
      (dismiss)="successMessage = ''">
    </app-alert>

    <div class="users-table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>Username</th>
            <th>Email</th>
            <th>Role</th>
            <th>Facility</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of users">
            <td>{{ user.username }}</td>
            <td>{{ user.email || '-' }}</td>
            <td><span class="badge badge-info">{{ user.role }}</span></td>
            <td>{{ user.facilityName || '-' }}</td>
            <td>
              <span class="badge" [ngClass]="user.isActive ? 'badge-success' : 'badge-danger'">
                {{ user.isActive ? 'Active' : 'Inactive' }}
              </span>
            </td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon" (click)="openEditForm(user)" title="Edit">‚úèÔ∏è</button>
                <button class="btn-icon btn-danger" (click)="openDeleteModal(user)" title="Delete">üóëÔ∏è</button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Create/Edit Modal -->
    <div *ngIf="showCreateForm || showEditForm" class="modal-overlay" (click)="closeForms()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>{{ showEditForm ? 'Edit User' : 'Create User' }}</h2>
          <button class="modal-close" (click)="closeForms()">√ó</button>
        </div>
        <form [formGroup]="userForm" (ngSubmit)="onSubmit()" class="modal-body">
          <div class="form-group">
            <label>Username *</label>
            <input type="text" formControlName="username" class="form-control" [readonly]="showEditForm">
          </div>
          <div class="form-group">
            <label>Password {{ showEditForm ? '(leave blank to keep current)' : '*' }}</label>
            <input type="password" formControlName="password" class="form-control">
          </div>
          <div class="form-group">
            <label>Email</label>
            <input type="email" formControlName="email" class="form-control">
          </div>
          <div class="form-group">
            <label>Role *</label>
            <select formControlName="role" class="form-control">
              <option [value]="UserRole.HEALTH_WORKER">Health Worker</option>
              <option [value]="UserRole.FACILITY_MANAGER">Facility Manager</option>
              <option [value]="UserRole.GOVERNMENT_OFFICIAL">Government Official</option>
            </select>
          </div>
          <div class="form-group">
            <label>First Name</label>
            <input type="text" formControlName="firstName" class="form-control">
          </div>
          <div class="form-group">
            <label>Last Name</label>
            <input type="text" formControlName="lastName" class="form-control">
          </div>
          <div class="form-group">
            <label>Facility ID</label>
            <input type="text" formControlName="facilityId" class="form-control">
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" (click)="closeForms()">Cancel</button>
            <button type="submit" class="btn btn-primary" [disabled]="userForm.invalid || loading">
              {{ showEditForm ? 'Update' : 'Create' }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <app-confirmation-modal
      [show]="showDeleteModal"
      title="Delete User"
      [message]="'Are you sure you want to delete user ' + (userToDelete?.username || '') + '?'"
      confirmText="Delete"
      cancelText="Cancel"
      type="danger"
      (confirmed)="confirmDelete()"
      (cancelled)="cancelDelete()">
    </app-confirmation-modal>

    <app-loader *ngIf="loading"></app-loader>
  </div>
</app-layout>



