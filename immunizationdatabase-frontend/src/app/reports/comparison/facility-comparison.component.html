<div class="comparison-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-left">
      <mat-icon class="header-icon">compare_arrows</mat-icon>
      <div class="header-text">
        <h1>Facility Comparison</h1>
        <p class="subtitle">Benchmark performance metrics and identify best practices</p>
      </div>
    </div>
    <div class="header-actions">
      <button mat-raised-button (click)="refreshReport()">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button mat-raised-button [matMenuTriggerFor]="exportMenu" color="primary">
        <mat-icon>file_download</mat-icon>
        Export
      </button>
      <mat-menu #exportMenu="matMenu">
        <button mat-menu-item (click)="exportReport('csv')">
          <mat-icon>description</mat-icon>
          CSV Format
        </button>
        <button mat-menu-item (click)="exportReport('pdf')">
          <mat-icon>picture_as_pdf</mat-icon>
          PDF Format
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- Filters -->
  <mat-card class="filters-card">
    <div class="filters-grid">
      <mat-form-field appearance="outline">
        <mat-label>District</mat-label>
        <mat-select [(ngModel)]="selectedDistrict">
          <mat-option *ngFor="let district of districtOptions" [value]="district">
            {{ district }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Metric</mat-label>
        <mat-select [(ngModel)]="selectedMetric">
          <mat-option *ngFor="let metric of metricOptions" [value]="metric.value">
            {{ metric.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Period</mat-label>
        <mat-select [(ngModel)]="selectedPeriod">
          <mat-option *ngFor="let period of periodOptions" [value]="period.value">
            {{ period.label }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="filter-actions">
      <button mat-raised-button (click)="resetFilters()">Reset</button>
      <button mat-raised-button color="primary" (click)="applyFilters()">Apply Filters</button>
    </div>
  </mat-card>

  <!-- KPIs -->
  <div class="kpi-grid">
    <mat-card class="kpi-card">
      <div class="kpi-content">
        <div class="kpi-icon average-coverage">
          <mat-icon>assessment</mat-icon>
        </div>
        <div class="kpi-details">
          <div class="kpi-label">Average Coverage</div>
          <div class="kpi-value">{{ kpis.averageCoverage }}%</div>
          <div class="kpi-subtitle">Across all facilities</div>
        </div>
      </div>
    </mat-card>

    <mat-card class="kpi-card">
      <div class="kpi-content">
        <div class="kpi-icon average-stock">
          <mat-icon>inventory_2</mat-icon>
        </div>
        <div class="kpi-details">
          <div class="kpi-label">Average Stock</div>
          <div class="kpi-value">{{ kpis.averageStockLevel }}%</div>
          <div class="kpi-subtitle">Stock availability</div>
        </div>
      </div>
    </mat-card>

    <mat-card class="kpi-card">
      <div class="kpi-content">
        <div class="kpi-icon average-wastage">
          <mat-icon>delete_outline</mat-icon>
        </div>
        <div class="kpi-details">
          <div class="kpi-label">Average Wastage</div>
          <div class="kpi-value">{{ kpis.averageWastage }}%</div>
          <div class="kpi-subtitle">Vaccine wastage rate</div>
        </div>
      </div>
    </mat-card>

    <mat-card class="kpi-card">
      <div class="kpi-content">
        <div class="kpi-icon total-facilities">
          <mat-icon>business</mat-icon>
        </div>
        <div class="kpi-details">
          <div class="kpi-label">Total Facilities</div>
          <div class="kpi-value">{{ kpis.totalFacilities }}</div>
          <div class="kpi-subtitle">In comparison</div>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Facility Rankings -->
  <mat-card class="section-card">
    <div class="section-header">
      <mat-icon>leaderboard</mat-icon>
      <h2>Facility Rankings</h2>
    </div>
    <div class="table-container">
      <table mat-table [dataSource]="facilityMetrics" class="comparison-table">
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef>Rank</th>
          <td mat-cell *matCellDef="let facility">
            <div class="rank-badge" [ngClass]="getRankClass(facility.rank)">
              {{ facility.rank }}
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="facility">
          <th mat-header-cell *matHeaderCellDef>Facility</th>
          <td mat-cell *matCellDef="let facility">
            <div class="facility-info">
              <div class="facility-name">{{ facility.facilityName }}</div>
              <div class="facility-id">{{ facility.facilityId }}</div>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="district">
          <th mat-header-cell *matHeaderCellDef>District</th>
          <td mat-cell *matCellDef="let facility">{{ facility.district }}</td>
        </ng-container>

        <ng-container matColumnDef="coverage">
          <th mat-header-cell *matHeaderCellDef>Coverage</th>
          <td mat-cell *matCellDef="let facility">
            <div class="metric-cell">
              <div class="metric-value">{{ facility.coverageRate }}%</div>
              <mat-progress-bar mode="determinate" [value]="facility.coverageRate"></mat-progress-bar>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="stock">
          <th mat-header-cell *matHeaderCellDef>Stock Level</th>
          <td mat-cell *matCellDef="let facility">
            <div class="metric-cell">
              <div class="metric-value">{{ facility.stockLevel }}%</div>
              <mat-progress-bar mode="determinate" [value]="facility.stockLevel"></mat-progress-bar>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="wastage">
          <th mat-header-cell *matHeaderCellDef>Wastage</th>
          <td mat-cell *matCellDef="let facility">{{ facility.wastageRate }}%</td>
        </ng-container>

        <ng-container matColumnDef="efficiency">
          <th mat-header-cell *matHeaderCellDef>Efficiency</th>
          <td mat-cell *matCellDef="let facility">{{ facility.efficiency }}%</td>
        </ng-container>

        <ng-container matColumnDef="trend">
          <th mat-header-cell *matHeaderCellDef>Trend</th>
          <td mat-cell *matCellDef="let facility">
            <div class="trend-indicator" [ngClass]="getTrendClass(facility.trend)">
              <mat-icon>{{ getTrendIcon(facility.trend) }}</mat-icon>
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="score">
          <th mat-header-cell *matHeaderCellDef>Score</th>
          <td mat-cell *matCellDef="let facility">
            <mat-chip [ngClass]="getScoreClass(facility.performanceScore)">
              {{ facility.performanceScore }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="facilityDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: facilityDisplayedColumns;"></tr>
      </table>
    </div>
  </mat-card>

  <!-- Performance Comparison Chart -->
  <mat-card class="section-card">
    <div class="section-header">
      <mat-icon>bar_chart</mat-icon>
      <h2>Performance Trends</h2>
    </div>
    <div class="chart-container">
      <div class="chart-legend">
        <div class="legend-item">
          <div class="legend-color fac001"></div>
          <span>Central Health Center</span>
        </div>
        <div class="legend-item">
          <div class="legend-color fac002"></div>
          <span>North Community Center</span>
        </div>
        <div class="legend-item">
          <div class="legend-color fac003"></div>
          <span>West Medical Facility</span>
        </div>
        <div class="legend-item">
          <div class="legend-color fac004"></div>
          <span>East District Clinic</span>
        </div>
        <div class="legend-item">
          <div class="legend-color national"></div>
          <span>National Average</span>
        </div>
      </div>
      <div class="trend-chart">
        <div *ngFor="let month of trendData" class="month-group">
          <div class="month-label">{{ month.month }}</div>
          <div class="trend-bars">
            <div class="trend-bar fac001-bar" 
                 [style.height.%]="month.fac001"
                 [matTooltip]="'Central: ' + month.fac001 + '%'"></div>
            <div class="trend-bar fac002-bar" 
                 [style.height.%]="month.fac002"
                 [matTooltip]="'North: ' + month.fac002 + '%'"></div>
            <div class="trend-bar fac003-bar" 
                 [style.height.%]="month.fac003"
                 [matTooltip]="'West: ' + month.fac003 + '%'"></div>
            <div class="trend-bar fac004-bar" 
                 [style.height.%]="month.fac004"
                 [matTooltip]="'East: ' + month.fac004 + '%'"></div>
            <div class="trend-bar national-bar" 
                 [style.height.%]="month.national"
                 [matTooltip]="'National: ' + month.national + '%'"></div>
          </div>
        </div>
      </div>
    </div>
  </mat-card>

  <!-- Performance Categories -->
  <mat-card class="section-card">
    <div class="section-header">
      <mat-icon>category</mat-icon>
      <h2>Performance Categories</h2>
    </div>
    <div class="table-container">
      <table mat-table [dataSource]="performanceCategories" class="comparison-table">
        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let cat">
            <strong>{{ cat.category }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="description">
          <th mat-header-cell *matHeaderCellDef>Description</th>
          <td mat-cell *matCellDef="let cat">{{ cat.description }}</td>
        </ng-container>

        <ng-container matColumnDef="topFacility">
          <th mat-header-cell *matHeaderCellDef>Top Performer</th>
          <td mat-cell *matCellDef="let cat">{{ cat.topFacility }}</td>
        </ng-container>

        <ng-container matColumnDef="topScore">
          <th mat-header-cell *matHeaderCellDef>Top Score</th>
          <td mat-cell *matCellDef="let cat">
            <strong>{{ cat.topScore }}%</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="averageScore">
          <th mat-header-cell *matHeaderCellDef>Average</th>
          <td mat-cell *matCellDef="let cat">{{ cat.averageScore }}%</td>
        </ng-container>

        <ng-container matColumnDef="facilities">
          <th mat-header-cell *matHeaderCellDef>Facilities</th>
          <td mat-cell *matCellDef="let cat">{{ cat.facilities }}</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="categoryDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: categoryDisplayedColumns;"></tr>
      </table>
    </div>
  </mat-card>

  <!-- Metric Comparison -->
  <mat-card class="section-card">
    <div class="section-header">
      <mat-icon>compare</mat-icon>
      <h2>Metric Comparison</h2>
    </div>
    <div class="table-container">
      <table mat-table [dataSource]="metricComparison" class="comparison-table">
        <ng-container matColumnDef="metric">
          <th mat-header-cell *matHeaderCellDef>Metric</th>
          <td mat-cell *matCellDef="let met">
            <strong>{{ met.metric }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="national">
          <th mat-header-cell *matHeaderCellDef>National</th>
          <td mat-cell *matCellDef="let met">{{ met.national }}</td>
        </ng-container>

        <ng-container matColumnDef="district">
          <th mat-header-cell *matHeaderCellDef>District</th>
          <td mat-cell *matCellDef="let met">{{ met.district }}</td>
        </ng-container>

        <ng-container matColumnDef="facility">
          <th mat-header-cell *matHeaderCellDef>Your Facility</th>
          <td mat-cell *matCellDef="let met">
            <strong>{{ met.facility }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="variance">
          <th mat-header-cell *matHeaderCellDef>Variance</th>
          <td mat-cell *matCellDef="let met">
            <span [ngClass]="met.variance > 0 ? 'positive-variance' : 'negative-variance'">
              {{ met.variance > 0 ? '+' : '' }}{{ met.variance }}
            </span>
          </td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let met">
            <mat-chip [ngClass]="getStatusClass(met.status)">
              {{ met.status }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="metricDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: metricDisplayedColumns;"></tr>
      </table>
    </div>
  </mat-card>

  <!-- District Comparison -->
  <mat-card class="section-card">
    <div class="section-header">
      <mat-icon>place</mat-icon>
      <h2>District Comparison</h2>
    </div>
    <div class="table-container">
      <table mat-table [dataSource]="districtComparison" class="comparison-table">
        <ng-container matColumnDef="rank">
          <th mat-header-cell *matHeaderCellDef>Rank</th>
          <td mat-cell *matCellDef="let dist">
            <div class="rank-badge" [ngClass]="getRankClass(dist.rank)">
              {{ dist.rank }}
            </div>
          </td>
        </ng-container>

        <ng-container matColumnDef="district">
          <th mat-header-cell *matHeaderCellDef>District</th>
          <td mat-cell *matCellDef="let dist">
            <strong>{{ dist.district }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="facilities">
          <th mat-header-cell *matHeaderCellDef>Facilities</th>
          <td mat-cell *matCellDef="let dist">{{ dist.facilities }}</td>
        </ng-container>

        <ng-container matColumnDef="coverage">
          <th mat-header-cell *matHeaderCellDef>Avg Coverage</th>
          <td mat-cell *matCellDef="let dist">{{ dist.averageCoverage }}%</td>
        </ng-container>

        <ng-container matColumnDef="vaccinations">
          <th mat-header-cell *matHeaderCellDef>Total Vaccinations</th>
          <td mat-cell *matCellDef="let dist">{{ dist.totalVaccinations }}</td>
        </ng-container>

        <ng-container matColumnDef="efficiency">
          <th mat-header-cell *matHeaderCellDef>Efficiency</th>
          <td mat-cell *matCellDef="let dist">{{ dist.stockEfficiency }}%</td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="districtDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: districtDisplayedColumns;"></tr>
      </table>
    </div>
  </mat-card>

  <!-- Best Practices -->
  <mat-card class="section-card">
    <div class="section-header">
      <mat-icon>emoji_events</mat-icon>
      <h2>Best Practices</h2>
    </div>
    <div class="best-practices-actions">
      <p>Learn from top-performing facilities and adopt their successful strategies</p>
    </div>
    <div class="table-container">
      <table mat-table [dataSource]="bestPractices" class="comparison-table">
        <ng-container matColumnDef="facility">
          <th mat-header-cell *matHeaderCellDef>Facility</th>
          <td mat-cell *matCellDef="let practice">
            <strong>{{ practice.facilityName }}</strong>
          </td>
        </ng-container>

        <ng-container matColumnDef="category">
          <th mat-header-cell *matHeaderCellDef>Category</th>
          <td mat-cell *matCellDef="let practice">{{ practice.category }}</td>
        </ng-container>

        <ng-container matColumnDef="practice">
          <th mat-header-cell *matHeaderCellDef>Practice</th>
          <td mat-cell *matCellDef="let practice">{{ practice.practice }}</td>
        </ng-container>

        <ng-container matColumnDef="impact">
          <th mat-header-cell *matHeaderCellDef>Impact</th>
          <td mat-cell *matCellDef="let practice">{{ practice.impact }}</td>
        </ng-container>

        <ng-container matColumnDef="metrics">
          <th mat-header-cell *matHeaderCellDef>Metrics</th>
          <td mat-cell *matCellDef="let practice">{{ practice.metrics }}</td>
        </ng-container>

        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let practice">
            <mat-chip [ngClass]="getPracticeStatusClass(practice.status)">
              {{ practice.status }}
            </mat-chip>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="practiceDisplayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: practiceDisplayedColumns;"></tr>
      </table>
    </div>
  </mat-card>
</div>
