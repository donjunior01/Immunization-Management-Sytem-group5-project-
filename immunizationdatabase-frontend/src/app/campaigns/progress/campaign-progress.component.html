<div class="progress-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading && !campaign" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading campaign details...</p>
  </div>

  <!-- Campaign Details -->
  <div *ngIf="!isLoading && campaign" class="content">
    <!-- Header -->
    <div class="page-header">
      <button mat-icon-button (click)="goBack()" matTooltip="Back to campaigns">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="header-content">
        <h1>
          <mat-icon>campaign</mat-icon>
          {{ campaign.name }}
        </h1>
        <mat-chip [color]="getStatusColor(campaign.status)" selected>
          <mat-icon>{{ getStatusIcon(campaign.status) }}</mat-icon>
          {{ campaign.status }}
        </mat-chip>
      </div>
      <button mat-button [matMenuTriggerFor]="menu">
        <mat-icon>more_vert</mat-icon>
        Actions
      </button>
      <mat-menu #menu="matMenu">
        <button mat-menu-item 
                *ngIf="campaign.status === 'PLANNED'"
                (click)="activateCampaign()">
          <mat-icon>play_circle</mat-icon>
          Activate Campaign
        </button>
        <button mat-menu-item 
                *ngIf="campaign.status === 'ACTIVE'"
                (click)="completeCampaign()">
          <mat-icon>check_circle</mat-icon>
          Mark as Completed
        </button>
        <button mat-menu-item 
                *ngIf="campaign.status !== 'CANCELLED' && campaign.status !== 'COMPLETED'"
                (click)="cancelCampaign()">
          <mat-icon>cancel</mat-icon>
          Cancel Campaign
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="exportReport()">
          <mat-icon>download</mat-icon>
          Export Report
        </button>
      </mat-menu>
    </div>

    <!-- Progress Section -->
    <mat-card class="progress-card">
      <mat-card-content>
        <h2>
          <mat-icon>show_chart</mat-icon>
          Vaccination Progress
        </h2>
        
        <div class="progress-section">
          <div class="coverage-circle">
            <svg width="200" height="200" viewBox="0 0 200 200">
              <circle
                cx="100"
                cy="100"
                r="90"
                fill="none"
                stroke="#e0e0e0"
                stroke-width="12"
              ></circle>
              <circle
                cx="100"
                cy="100"
                r="90"
                fill="none"
                [attr.stroke]="campaign.coveragePercentage >= 90 ? '#4caf50' : campaign.coveragePercentage >= 70 ? '#2196f3' : campaign.coveragePercentage >= 50 ? '#ff9800' : '#f44336'"
                stroke-width="12"
                [attr.stroke-dasharray]="565.48"
                [attr.stroke-dashoffset]="565.48 - (565.48 * campaign.coveragePercentage / 100)"
                stroke-linecap="round"
                transform="rotate(-90 100 100)"
              ></circle>
            </svg>
            <div class="coverage-text">
              <div class="percentage">{{ campaign.coveragePercentage }}%</div>
              <div class="label">Coverage</div>
              <div class="status">{{ getCoverageStatus(campaign.coveragePercentage) }}</div>
            </div>
          </div>

          <div class="progress-stats">
            <div class="stat-item">
              <div class="stat-icon vaccinated">
                <mat-icon>vaccines</mat-icon>
              </div>
              <div class="stat-details">
                <div class="stat-value">{{ campaign.vaccinatedCount }}</div>
                <div class="stat-label">People Vaccinated</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon target">
                <mat-icon>people</mat-icon>
              </div>
              <div class="stat-details">
                <div class="stat-value">{{ campaign.targetPopulation || 'N/A' }}</div>
                <div class="stat-label">Target Population</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon remaining">
                <mat-icon>pending</mat-icon>
              </div>
              <div class="stat-details">
                <div class="stat-value">
                  {{ campaign.targetPopulation ? (campaign.targetPopulation - campaign.vaccinatedCount) : 'N/A' }}
                </div>
                <div class="stat-label">Remaining</div>
              </div>
            </div>

            <div class="stat-item">
              <div class="stat-icon duration">
                <mat-icon>event</mat-icon>
              </div>
              <div class="stat-details">
                <div class="stat-value">{{ getDaysRemaining() }}</div>
                <div class="stat-label">Days Remaining</div>
              </div>
            </div>
          </div>
        </div>

        <mat-progress-bar 
          mode="determinate" 
          [value]="campaign.coveragePercentage"
          [color]="campaign.coveragePercentage >= 70 ? 'primary' : 'warn'"
          class="progress-bar">
        </mat-progress-bar>
      </mat-card-content>
    </mat-card>

    <!-- Campaign Details Section -->
    <div class="details-grid">
      <!-- Basic Information -->
      <mat-card class="detail-card">
        <mat-card-content>
          <h3>
            <mat-icon>info</mat-icon>
            Campaign Information
          </h3>
          <div class="detail-row">
            <span class="detail-label">
              <mat-icon>vaccines</mat-icon>
              Vaccine Type
            </span>
            <span class="detail-value">{{ campaign.vaccineName }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">
              <mat-icon>groups</mat-icon>
              Target Age Group
            </span>
            <span class="detail-value">{{ campaign.targetAgeGroup || 'All Ages' }}</span>
          </div>
          <div class="detail-row" *ngIf="campaign.description">
            <span class="detail-label">
              <mat-icon>description</mat-icon>
              Description
            </span>
            <span class="detail-value description">{{ campaign.description }}</span>
          </div>
        </mat-card-content>
      </mat-card>

      <!-- Schedule Information -->
      <mat-card class="detail-card">
        <mat-card-content>
          <h3>
            <mat-icon>schedule</mat-icon>
            Campaign Schedule
          </h3>
          <div class="detail-row">
            <span class="detail-label">
              <mat-icon>event</mat-icon>
              Start Date
            </span>
            <span class="detail-value">{{ formatDate(campaign.startDate) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">
              <mat-icon>event</mat-icon>
              End Date
            </span>
            <span class="detail-value">{{ formatDate(campaign.endDate) }}</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">
              <mat-icon>hourglass_empty</mat-icon>
              Duration
            </span>
            <span class="detail-value">{{ getDurationDays() }} days</span>
          </div>
          <div class="detail-row">
            <span class="detail-label">
              <mat-icon>access_time</mat-icon>
              Created At
            </span>
            <span class="detail-value">{{ formatDate(campaign.createdAt) }}</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- No Campaign Found -->
  <div *ngIf="!isLoading && !campaign" class="no-data">
    <mat-icon>error_outline</mat-icon>
    <p>Campaign not found</p>
    <button mat-raised-button color="primary" (click)="goBack()">
      <mat-icon>arrow_back</mat-icon>
      Back to Campaigns
    </button>
  </div>
</div>
