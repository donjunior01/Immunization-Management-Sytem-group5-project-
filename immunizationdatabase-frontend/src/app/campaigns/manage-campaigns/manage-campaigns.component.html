<div class="manage-campaigns-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <mat-icon class="page-icon">campaign</mat-icon>
        <div>
          <h1>Manage Campaigns</h1>
          <p>Create and monitor vaccination campaigns</p>
        </div>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="showCreateForm()">
          <mat-icon>add</mat-icon>
          Create Campaign
        </button>
        <button mat-stroked-button (click)="exportCampaigns()">
          <mat-icon>download</mat-icon>
          Export
        </button>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <mat-card class="stat-card total">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>campaign</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.total }}</div>
          <div class="stat-label">Total Campaigns</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card active">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>play_circle</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.active }}</div>
          <div class="stat-label">Active Campaigns</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card planned">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>schedule</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.planned }}</div>
          <div class="stat-label">Planned Campaigns</div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card completed">
      <mat-card-content>
        <div class="stat-icon">
          <mat-icon>check_circle</mat-icon>
        </div>
        <div class="stat-info">
          <div class="stat-value">{{ stats.completed }}</div>
          <div class="stat-label">Completed Campaigns</div>
        </div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Create/Edit Form -->
  <mat-card class="form-card" *ngIf="isFormVisible">
    <mat-card-header>
      <mat-card-title>
        <mat-icon>{{ isEditMode ? 'edit' : 'add_circle' }}</mat-icon>
        {{ isEditMode ? 'Edit Campaign' : 'Create New Campaign' }}
      </mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <form [formGroup]="campaignForm" (ngSubmit)="saveCampaign()">
        <div class="form-grid">
          <!-- Campaign Name -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Campaign Name</mat-label>
            <input matInput formControlName="name" placeholder="Enter campaign name">
            <mat-icon matPrefix>title</mat-icon>
            <mat-error *ngIf="campaignForm.get('name')?.hasError('required')">
              Campaign name is required
            </mat-error>
            <mat-error *ngIf="campaignForm.get('name')?.hasError('minlength')">
              Name must be at least 5 characters
            </mat-error>
          </mat-form-field>

          <!-- Vaccine Name -->
          <mat-form-field appearance="outline">
            <mat-label>Vaccine</mat-label>
            <mat-select formControlName="vaccineName">
              <mat-option *ngFor="let vaccine of vaccines" [value]="vaccine">
                {{ vaccine }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>vaccines</mat-icon>
            <mat-error>Vaccine is required</mat-error>
          </mat-form-field>

          <!-- Target Age Group -->
          <mat-form-field appearance="outline">
            <mat-label>Target Age Group</mat-label>
            <input matInput formControlName="targetAgeGroup" placeholder="e.g., 0-1 months">
            <mat-icon matPrefix>child_care</mat-icon>
            <mat-error>Target age group is required</mat-error>
          </mat-form-field>

          <!-- Start Date -->
          <mat-form-field appearance="outline">
            <mat-label>Start Date</mat-label>
            <input matInput [matDatepicker]="startPicker" formControlName="startDate">
            <mat-datepicker-toggle matPrefix [for]="startPicker"></mat-datepicker-toggle>
            <mat-datepicker #startPicker></mat-datepicker>
            <mat-error>Start date is required</mat-error>
          </mat-form-field>

          <!-- End Date -->
          <mat-form-field appearance="outline">
            <mat-label>End Date</mat-label>
            <input matInput [matDatepicker]="endPicker" formControlName="endDate">
            <mat-datepicker-toggle matPrefix [for]="endPicker"></mat-datepicker-toggle>
            <mat-datepicker #endPicker></mat-datepicker>
            <mat-error>End date is required</mat-error>
          </mat-form-field>

          <!-- Target Population -->
          <mat-form-field appearance="outline">
            <mat-label>Target Population</mat-label>
            <input matInput type="number" formControlName="targetPopulation" placeholder="Enter target number">
            <mat-icon matPrefix>people</mat-icon>
            <mat-error>Target population must be greater than 0</mat-error>
          </mat-form-field>

          <!-- Scope -->
          <mat-form-field appearance="outline">
            <mat-label>Campaign Scope</mat-label>
            <mat-select formControlName="scope">
              <mat-option *ngFor="let scope of scopeOptions" [value]="scope">
                {{ scope }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>public</mat-icon>
            <mat-error>Scope is required</mat-error>
          </mat-form-field>

          <!-- Status -->
          <mat-form-field appearance="outline">
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let status of statusOptions" [value]="status">
                {{ status }}
              </mat-option>
            </mat-select>
            <mat-icon matPrefix>flag</mat-icon>
            <mat-error>Status is required</mat-error>
          </mat-form-field>

          <!-- Description -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Description</mat-label>
            <textarea matInput formControlName="description" rows="3" placeholder="Enter campaign description"></textarea>
            <mat-icon matPrefix>description</mat-icon>
            <mat-error *ngIf="campaignForm.get('description')?.hasError('required')">
              Description is required
            </mat-error>
            <mat-error *ngIf="campaignForm.get('description')?.hasError('minlength')">
              Description must be at least 10 characters
            </mat-error>
          </mat-form-field>
        </div>

        <!-- Form Actions -->
        <div class="form-actions">
          <button mat-button type="button" (click)="hideForm()">
            Cancel
          </button>
          <button mat-raised-button color="primary" type="submit" [disabled]="campaignForm.invalid">
            <mat-icon>{{ isEditMode ? 'save' : 'add' }}</mat-icon>
            {{ isEditMode ? 'Update Campaign' : 'Create Campaign' }}
          </button>
        </div>
      </form>
    </mat-card-content>
  </mat-card>

  <!-- Filters -->
  <mat-card class="filters-card">
    <mat-card-content>
      <div class="filters-row">
        <mat-form-field appearance="outline" class="search-field">
          <mat-label>Search campaigns</mat-label>
          <input matInput (input)="onSearch($event)" placeholder="Search by name, vaccine, or description">
          <mat-icon matPrefix>search</mat-icon>
        </mat-form-field>

        <div class="status-chips">
          <mat-chip-set aria-label="Status filter">
            <mat-chip [class.active]="statusFilter === 'ALL'" (click)="onStatusFilterChange('ALL')">
              All
            </mat-chip>
            <mat-chip [class.active]="statusFilter === 'ACTIVE'" (click)="onStatusFilterChange('ACTIVE')">
              <mat-icon>play_circle</mat-icon>
              Active
            </mat-chip>
            <mat-chip [class.active]="statusFilter === 'PLANNED'" (click)="onStatusFilterChange('PLANNED')">
              <mat-icon>schedule</mat-icon>
              Planned
            </mat-chip>
            <mat-chip [class.active]="statusFilter === 'COMPLETED'" (click)="onStatusFilterChange('COMPLETED')">
              <mat-icon>check_circle</mat-icon>
              Completed
            </mat-chip>
          </mat-chip-set>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- Campaigns Table -->
  <mat-card class="table-card">
    <mat-card-content>
      <table mat-table [dataSource]="filteredCampaigns">
        <!-- Name Column -->
        <ng-container matColumnDef="name">
          <th mat-header-cell *matHeaderCellDef>Campaign Name</th>
          <td mat-cell *matCellDef="let campaign">
            <div class="campaign-name">
              <mat-icon [matTooltip]="campaign.scope">{{ getScopeIcon(campaign.scope) }}</mat-icon>
              <div>
                <div class="name">{{ campaign.name }}</div>
                <div class="description">{{ campaign.description }}</div>
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Vaccine Column -->
        <ng-container matColumnDef="vaccine">
          <th mat-header-cell *matHeaderCellDef>Vaccine & Target</th>
          <td mat-cell *matCellDef="let campaign">
            <div class="vaccine-info">
              <mat-chip color="primary">
                <mat-icon>vaccines</mat-icon>
                {{ campaign.vaccineName }}
              </mat-chip>
              <div class="age-group">{{ campaign.targetAgeGroup }}</div>
            </div>
          </td>
        </ng-container>

        <!-- Dates Column -->
        <ng-container matColumnDef="dates">
          <th mat-header-cell *matHeaderCellDef>Campaign Period</th>
          <td mat-cell *matCellDef="let campaign">
            <div class="dates-info">
              <div class="date">
                <mat-icon>event</mat-icon>
                {{ campaign.startDate | date:'mediumDate' }}
              </div>
              <mat-icon class="arrow">arrow_forward</mat-icon>
              <div class="date">
                <mat-icon>event</mat-icon>
                {{ campaign.endDate | date:'mediumDate' }}
              </div>
            </div>
          </td>
        </ng-container>

        <!-- Progress Column -->
        <ng-container matColumnDef="progress">
          <th mat-header-cell *matHeaderCellDef>Progress</th>
          <td mat-cell *matCellDef="let campaign">
            <div class="progress-info">
              <div class="progress-text">
                {{ campaign.vaccinatedCount | number }} / {{ campaign.targetPopulation | number }}
              </div>
              <mat-progress-bar
                mode="determinate"
                [value]="campaign.coveragePercent"
                [color]="campaign.coveragePercent >= 80 ? 'primary' : 'warn'">
              </mat-progress-bar>
            </div>
          </td>
        </ng-container>

        <!-- Coverage Column -->
        <ng-container matColumnDef="coverage">
          <th mat-header-cell *matHeaderCellDef>Coverage</th>
          <td mat-cell *matCellDef="let campaign">
            <div class="coverage-badge" [style.background]="getCoverageColor(campaign.coveragePercent)">
              {{ campaign.coveragePercent | number:'1.1-1' }}%
            </div>
          </td>
        </ng-container>

        <!-- Status Column -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>Status</th>
          <td mat-cell *matCellDef="let campaign">
            <mat-chip [ngClass]="getStatusClass(campaign.status)">
              <mat-icon>{{ getStatusIcon(campaign.status) }}</mat-icon>
              {{ campaign.status }}
            </mat-chip>
          </td>
        </ng-container>

        <!-- Actions Column -->
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Actions</th>
          <td mat-cell *matCellDef="let campaign">
            <div class="action-buttons">
              <button mat-icon-button [matTooltip]="'View Details'" (click)="viewCampaignDetails(campaign)">
                <mat-icon>visibility</mat-icon>
              </button>
              <button mat-icon-button [matTooltip]="'Edit Campaign'" (click)="editCampaign(campaign)">
                <mat-icon>edit</mat-icon>
              </button>
              <button mat-icon-button [matTooltip]="'Delete Campaign'" (click)="deleteCampaign(campaign)">
                <mat-icon>delete</mat-icon>
              </button>
            </div>
          </td>
        </ng-container>

        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
      </table>

      <div class="no-data" *ngIf="filteredCampaigns.length === 0">
        <mat-icon>campaign</mat-icon>
        <p>No campaigns found</p>
        <button mat-raised-button color="primary" (click)="showCreateForm()" *ngIf="!isFormVisible">
          Create Your First Campaign
        </button>
      </div>
    </mat-card-content>
  </mat-card>
</div>
