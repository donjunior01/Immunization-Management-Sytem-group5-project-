<div class="dashboard-container">
  <!-- Loading Spinner -->
  <div *ngIf="isLoading" class="loading-overlay">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading facility dashboard data...</p>
  </div>

  <!-- Welcome Header -->
  <div class="welcome-section">
    <div class="welcome-header">
      <div>
        <h1 class="welcome-title">Facility Management Dashboard</h1>
        <p class="welcome-subtitle">{{ currentUser?.facilityId }} â€¢ {{ currentUser?.fullName }}</p>
      </div>
      <div class="header-actions">
        <button mat-raised-button color="primary" (click)="navigateToCreateCampaign()">
          <mat-icon>campaign</mat-icon> Create Campaign
        </button>
        <button mat-raised-button color="accent" (click)="navigateToAllocateStaff()">
          <mat-icon>people</mat-icon> Assign Staff
        </button>
        <button mat-raised-button (click)="navigateToReports()">
          <mat-icon>analytics</mat-icon> View Reports
        </button>
      </div>
    </div>
  </div>

  <!-- Quick Stats Grid -->
  <div class="stats-grid">
    <mat-card class="stat-card">
      <div class="stat-content">
        <div class="stat-icon-wrapper purple">
          <mat-icon class="stat-icon">people</mat-icon>
        </div>
        <div class="stat-details">
          <h3 class="stat-value">{{ stats.totalStaff }}</h3>
          <p class="stat-label">Total Staff</p>
          <p class="stat-sublabel">{{ stats.activeHealthWorkers }} active workers</p>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <div class="stat-icon-wrapper blue">
          <mat-icon class="stat-icon">person</mat-icon>
        </div>
        <div class="stat-details">
          <h3 class="stat-value">{{ stats.totalPatients }}</h3>
          <p class="stat-label">Total Patients</p>
          <p class="stat-sublabel">Registered at facility</p>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <div class="stat-icon-wrapper green">
          <mat-icon class="stat-icon">vaccines</mat-icon>
        </div>
        <div class="stat-details">
          <h3 class="stat-value">{{ stats.vaccinationsThisMonth }}</h3>
          <p class="stat-label">Vaccinations (This Month)</p>
          <p class="stat-sublabel">Coverage: {{ stats.coverageRate }}%</p>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <div class="stat-icon-wrapper orange">
          <mat-icon class="stat-icon" [matBadge]="stats.activeCampaigns" matBadgeColor="accent" aria-hidden="false">campaign</mat-icon>
        </div>
        <div class="stat-details">
          <h3 class="stat-value">{{ stats.activeCampaigns }}</h3>
          <p class="stat-label">Active Campaigns</p>
          <p class="stat-sublabel">In progress</p>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <div class="stat-icon-wrapper teal">
          <mat-icon class="stat-icon">inventory_2</mat-icon>
        </div>
        <div class="stat-details">
          <h3 class="stat-value">{{ stats.totalVaccineStock }}</h3>
          <p class="stat-label">Total Vaccine Stock</p>
          <p class="stat-sublabel">Across all types</p>
        </div>
      </div>
    </mat-card>

    <mat-card class="stat-card">
      <div class="stat-content">
        <div class="stat-icon-wrapper red">
          <mat-icon class="stat-icon" [matBadge]="stats.lowStockItems" matBadgeColor="warn" aria-hidden="false">warning</mat-icon>
        </div>
        <div class="stat-details">
          <h3 class="stat-value">{{ stats.lowStockItems }}</h3>
          <p class="stat-label">Low Stock Alerts</p>
          <p class="stat-sublabel">Requires attention</p>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Tabs for Different Views -->
  <mat-tab-group class="dashboard-tabs" animationDuration="300ms">
    <!-- Staff Management Tab -->
    <mat-tab label="Staff Management">
      <div class="tab-content">
        <mat-card class="content-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon class="header-icon">people</mat-icon>
              Staff Performance & Activity
            </mat-card-title>
            <button mat-icon-button color="primary" (click)="navigateToStaffManagement()">
              <mat-icon>open_in_new</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="staffMembers" class="data-table">
              <!-- ID Column -->
              <ng-container matColumnDef="id">
                <th mat-header-cell *matHeaderCellDef>ID</th>
                <td mat-cell *matCellDef="let staff">{{ staff.id }}</td>
              </ng-container>

              <!-- Name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Name</th>
                <td mat-cell *matCellDef="let staff">
                  <strong>{{ staff.name }}</strong>
                </td>
              </ng-container>

              <!-- Role Column -->
              <ng-container matColumnDef="role">
                <th mat-header-cell *matHeaderCellDef>Role</th>
                <td mat-cell *matCellDef="let staff">{{ staff.role }}</td>
              </ng-container>

              <!-- Patients Registered Column -->
              <ng-container matColumnDef="patientsRegistered">
                <th mat-header-cell *matHeaderCellDef>Patients</th>
                <td mat-cell *matCellDef="let staff">{{ staff.patientsRegistered }}</td>
              </ng-container>

              <!-- Vaccinations Today Column -->
              <ng-container matColumnDef="vaccinationsToday">
                <th mat-header-cell *matHeaderCellDef>Today</th>
                <td mat-cell *matCellDef="let staff">
                  <mat-chip [color]="staff.vaccinationsToday > 0 ? 'primary' : ''">
                    {{ staff.vaccinationsToday }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let staff">
                  <mat-chip [class]="getStaffStatusClass(staff.status)">
                    {{ staff.status === 'on-leave' ? 'On Leave' : staff.status | titlecase }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let staff">
                  <button mat-icon-button color="primary" (click)="viewStaffDetails(staff)" matTooltip="View Details">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button color="accent" (click)="assignStaffToCampaign(staff)" matTooltip="Assign to Campaign">
                    <mat-icon>assignment</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="staffColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: staffColumns;"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Campaign Management Tab -->
    <mat-tab label="Active Campaigns">
      <div class="tab-content">
        <mat-card class="content-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon class="header-icon">campaign</mat-icon>
              Campaign Progress & Tracking
            </mat-card-title>
            <button mat-icon-button color="primary" (click)="navigateToCampaignManagement()">
              <mat-icon>open_in_new</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="campaigns" class="data-table">
              <!-- Campaign Name Column -->
              <ng-container matColumnDef="name">
                <th mat-header-cell *matHeaderCellDef>Campaign</th>
                <td mat-cell *matCellDef="let campaign">
                  <div class="campaign-cell">
                    <strong>{{ campaign.name }}</strong>
                    <span class="campaign-id">{{ campaign.id }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Progress Column -->
              <ng-container matColumnDef="progress">
                <th mat-header-cell *matHeaderCellDef>Progress</th>
                <td mat-cell *matCellDef="let campaign">
                  <div class="progress-cell">
                    <span class="progress-text">{{ campaign.vaccinated }} / {{ campaign.targetPopulation }}</span>
                    <mat-progress-bar
                      mode="determinate"
                      [value]="campaign.coveragePercent"
                      [color]="getCoverageColor(campaign.coveragePercent)">
                    </mat-progress-bar>
                  </div>
                </td>
              </ng-container>

              <!-- Coverage Column -->
              <ng-container matColumnDef="coverage">
                <th mat-header-cell *matHeaderCellDef>Coverage</th>
                <td mat-cell *matCellDef="let campaign">
                  <mat-chip [color]="getCoverageColor(campaign.coveragePercent)">
                    {{ campaign.coveragePercent }}%
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Dates Column -->
              <ng-container matColumnDef="dates">
                <th mat-header-cell *matHeaderCellDef>Duration</th>
                <td mat-cell *matCellDef="let campaign">
                  <div class="dates-cell">
                    <span>{{ campaign.startDate }}</span>
                    <mat-icon>arrow_forward</mat-icon>
                    <span>{{ campaign.endDate }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Vaccines Column -->
              <ng-container matColumnDef="vaccines">
                <th mat-header-cell *matHeaderCellDef>Vaccines</th>
                <td mat-cell *matCellDef="let campaign">
                  <div class="vaccines-cell">
                    <span>Used: {{ campaign.vaccinesUsed }}</span>
                    <span>Allocated: {{ campaign.vaccinesAllocated }}</span>
                  </div>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let campaign">
                  <button mat-icon-button color="primary" (click)="viewCampaignDetails(campaign)" matTooltip="View Details">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button color="accent" (click)="allocateVaccinesToCampaign(campaign)" matTooltip="Allocate Vaccines">
                    <mat-icon>add_circle</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="campaignColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: campaignColumns;"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Inventory Management Tab -->
    <mat-tab label="Inventory Overview">
      <div class="tab-content">
        <mat-card class="content-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon class="header-icon">inventory_2</mat-icon>
              Facility-Wide Vaccine Inventory
            </mat-card-title>
            <button mat-icon-button color="primary" (click)="navigateToInventoryManagement()">
              <mat-icon>open_in_new</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="inventoryItems" class="data-table">
              <!-- Vaccine Name Column -->
              <ng-container matColumnDef="vaccineName">
                <th mat-header-cell *matHeaderCellDef>Vaccine</th>
                <td mat-cell *matCellDef="let item">
                  <strong>{{ item.vaccineName }}</strong>
                </td>
              </ng-container>

              <!-- Total Stock Column -->
              <ng-container matColumnDef="stock">
                <th mat-header-cell *matHeaderCellDef>Total Stock</th>
                <td mat-cell *matCellDef="let item">{{ item.totalStock }}</td>
              </ng-container>

              <!-- Allocated Column -->
              <ng-container matColumnDef="allocated">
                <th mat-header-cell *matHeaderCellDef>Allocated</th>
                <td mat-cell *matCellDef="let item">
                  <span class="allocated-badge">{{ item.allocated }}</span>
                </td>
              </ng-container>

              <!-- Available Column -->
              <ng-container matColumnDef="available">
                <th mat-header-cell *matHeaderCellDef>Available</th>
                <td mat-cell *matCellDef="let item">
                  <div class="available-cell">
                    <span>{{ item.available }}</span>
                    <mat-progress-bar
                      mode="determinate"
                      [value]="getStockPercentage(item)"
                      [class]="getStockStatusClass(item.status)">
                    </mat-progress-bar>
                  </div>
                </td>
              </ng-container>

              <!-- Expiring Column -->
              <ng-container matColumnDef="expiring">
                <th mat-header-cell *matHeaderCellDef>Expiring (30d)</th>
                <td mat-cell *matCellDef="let item">
                  <mat-chip [color]="item.expiringIn30Days > 0 ? 'warn' : ''">
                    {{ item.expiringIn30Days }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Status Column -->
              <ng-container matColumnDef="status">
                <th mat-header-cell *matHeaderCellDef>Status</th>
                <td mat-cell *matCellDef="let item">
                  <mat-chip [class]="getStockStatusClass(item.status)">
                    {{ item.status | titlecase }}
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Actions Column -->
              <ng-container matColumnDef="actions">
                <th mat-header-cell *matHeaderCellDef>Actions</th>
                <td mat-cell *matCellDef="let item">
                  <button mat-icon-button color="primary" (click)="viewInventoryDetails(item)" matTooltip="View Details">
                    <mat-icon>visibility</mat-icon>
                  </button>
                  <button mat-icon-button color="accent" (click)="reorderStock(item)" matTooltip="Reorder Stock">
                    <mat-icon>shopping_cart</mat-icon>
                  </button>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="inventoryColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: inventoryColumns;"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Facility Comparison Tab -->
    <mat-tab label="District Comparison">
      <div class="tab-content">
        <mat-card class="content-card">
          <mat-card-header>
            <mat-card-title>
              <mat-icon class="header-icon">leaderboard</mat-icon>
              District Facility Performance
            </mat-card-title>
            <button mat-icon-button color="primary" (click)="exportReport('facility-comparison')">
              <mat-icon>download</mat-icon>
            </button>
          </mat-card-header>
          <mat-card-content>
            <table mat-table [dataSource]="facilityComparisons" class="data-table">
              <!-- Rank Column -->
              <ng-container matColumnDef="rank">
                <th mat-header-cell *matHeaderCellDef>Rank</th>
                <td mat-cell *matCellDef="let facility">
                  <div class="rank-badge" [class.top-rank]="facility.rank === 1">
                    #{{ facility.rank }}
                  </div>
                </td>
              </ng-container>

              <!-- Facility Name Column -->
              <ng-container matColumnDef="facilityName">
                <th mat-header-cell *matHeaderCellDef>Facility</th>
                <td mat-cell *matCellDef="let facility">
                  <strong>{{ facility.facilityName }}</strong>
                </td>
              </ng-container>

              <!-- District Column -->
              <ng-container matColumnDef="district">
                <th mat-header-cell *matHeaderCellDef>District</th>
                <td mat-cell *matCellDef="let facility">{{ facility.district }}</td>
              </ng-container>

              <!-- Coverage Rate Column -->
              <ng-container matColumnDef="coverageRate">
                <th mat-header-cell *matHeaderCellDef>Coverage Rate</th>
                <td mat-cell *matCellDef="let facility">
                  <mat-chip [color]="getCoverageColor(facility.coverageRate)">
                    {{ facility.coverageRate }}%
                  </mat-chip>
                </td>
              </ng-container>

              <!-- Total Vaccinations Column -->
              <ng-container matColumnDef="totalVaccinations">
                <th mat-header-cell *matHeaderCellDef>Vaccinations</th>
                <td mat-cell *matCellDef="let facility">{{ facility.totalVaccinations }}</td>
              </ng-container>

              <!-- Stock Status Column -->
              <ng-container matColumnDef="stockStatus">
                <th mat-header-cell *matHeaderCellDef>Stock Status</th>
                <td mat-cell *matCellDef="let facility">
                  <mat-chip [class]="getStockStatusClass(facility.stockStatus)">
                    {{ facility.stockStatus | titlecase }}
                  </mat-chip>
                </td>
              </ng-container>

              <tr mat-header-row *matHeaderRowDef="facilityColumns"></tr>
              <tr mat-row *matRowDef="let row; columns: facilityColumns;"></tr>
            </table>
          </mat-card-content>
        </mat-card>
      </div>
    </mat-tab>
  </mat-tab-group>
</div>
