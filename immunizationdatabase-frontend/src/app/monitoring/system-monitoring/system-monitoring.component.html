<div class="system-monitoring-container">
  <!-- Page Header -->
  <div class="page-header">
    <div class="icon-wrapper">
      <mat-icon>monitor_heart</mat-icon>
    </div>
    <div class="header-content">
      <h1>System Monitoring Dashboard</h1>
      <p>Real-time monitoring of system health, performance, and data quality</p>
    </div>
    <div class="header-actions">
      <button mat-raised-button color="primary" (click)="loadMonitoringData()" type="button">
        <mat-icon>refresh</mat-icon>
        Refresh
      </button>
      <button mat-raised-button [matMenuTriggerFor]="exportMenu" type="button">
        <mat-icon>download</mat-icon>
        Export
      </button>
      <mat-menu #exportMenu="matMenu">
        <button mat-menu-item (click)="exportData('csv')" type="button">
          <mat-icon>description</mat-icon>
          <span>Export as CSV</span>
        </button>
        <button mat-menu-item (click)="exportData('json')" type="button">
          <mat-icon>code</mat-icon>
          <span>Export as JSON</span>
        </button>
      </mat-menu>
    </div>
  </div>

  <!-- System Health Overview -->
  <div class="health-overview">
    <mat-card class="health-card">
      <div class="health-status-badge" [ngClass]="systemHealth.overallStatus">
        <mat-icon>{{ systemHealth.overallStatus === 'healthy' ? 'check_circle' : systemHealth.overallStatus === 'degraded' ? 'warning' : 'error' }}</mat-icon>
        <span>{{ systemHealth.overallStatus | titlecase }}</span>
      </div>
      <div class="health-stats">
        <div class="health-stat">
          <div class="stat-label">Uptime</div>
          <div class="stat-value">{{ formatUptime(systemHealth.uptime) }}</div>
          <div class="stat-detail">{{ formatPercentage(systemHealth.uptimePercentage) }}</div>
        </div>
        <div class="health-stat">
          <div class="stat-label">CPU Usage</div>
          <div class="stat-value">{{ formatPercentage(systemHealth.cpuUsage) }}</div>
          <mat-progress-bar mode="determinate" [value]="systemHealth.cpuUsage"></mat-progress-bar>
        </div>
        <div class="health-stat">
          <div class="stat-label">Memory Usage</div>
          <div class="stat-value">{{ formatPercentage(systemHealth.memoryUsage) }}</div>
          <mat-progress-bar mode="determinate" [value]="systemHealth.memoryUsage"></mat-progress-bar>
        </div>
        <div class="health-stat">
          <div class="stat-label">Disk Usage</div>
          <div class="stat-value">{{ formatPercentage(systemHealth.diskUsage) }}</div>
          <mat-progress-bar mode="determinate" [value]="systemHealth.diskUsage"></mat-progress-bar>
        </div>
        <div class="health-stat">
          <div class="stat-label">Active Connections</div>
          <div class="stat-value">{{ formatNumber(systemHealth.activeConnections) }}</div>
          <div class="stat-detail">{{ systemHealth.queuedJobs }} queued jobs</div>
        </div>
      </div>
    </mat-card>
  </div>

  <!-- Analytics Cards -->
  <div class="analytics-overview">
    <div class="analytics-grid">
      <div class="analytics-card">
        <div class="card-icon primary">
          <mat-icon>notifications</mat-icon>
        </div>
        <div class="card-content">
          <div class="card-value">{{ analytics.totalAlerts }}</div>
          <div class="card-label">Total Alerts</div>
          <div class="card-breakdown">
            <span class="breakdown-item critical">{{ analytics.criticalAlerts }} Critical</span>
            <span class="breakdown-item warning">{{ analytics.warningAlerts }} Warning</span>
          </div>
        </div>
      </div>

      <div class="analytics-card">
        <div class="card-icon success">
          <mat-icon>health_and_safety</mat-icon>
        </div>
        <div class="card-content">
          <div class="card-value">{{ formatPercentage(analytics.systemHealthScore) }}</div>
          <div class="card-label">System Health</div>
          <div class="card-detail">All systems operational</div>
        </div>
      </div>

      <div class="analytics-card">
        <div class="card-icon info">
          <mat-icon>data_check</mat-icon>
        </div>
        <div class="card-content">
          <div class="card-value">{{ formatPercentage(analytics.dataQualityScore) }}</div>
          <div class="card-label">Data Quality</div>
          <div class="card-detail">Across all sources</div>
        </div>
      </div>

      <div class="analytics-card">
        <div class="card-icon accent">
          <mat-icon>api</mat-icon>
        </div>
        <div class="card-content">
          <div class="card-value">{{ formatPercentage(analytics.apiHealthScore) }}</div>
          <div class="card-label">API Health</div>
          <div class="card-detail">{{ apiEndpoints.length }} endpoints</div>
        </div>
      </div>

      <div class="analytics-card">
        <div class="card-icon warning">
          <mat-icon>speed</mat-icon>
        </div>
        <div class="card-content">
          <div class="card-value">{{ formatPercentage(analytics.performanceScore) }}</div>
          <div class="card-label">Performance</div>
          <div class="card-detail">Resource utilization</div>
        </div>
      </div>

      <div class="analytics-card">
        <div class="card-icon success">
          <mat-icon>done_all</mat-icon>
        </div>
        <div class="card-content">
          <div class="card-value">{{ analytics.resolvedAlerts }}</div>
          <div class="card-label">Resolved Alerts</div>
          <div class="card-detail">Avg {{ formatDuration(analytics.averageResolutionTime) }}</div>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Content Tabs -->
  <mat-tab-group class="tab-container">
    <!-- System Metrics Tab -->
    <mat-tab label="System Metrics">
      <div class="tab-content">
        <div class="metrics-grid">
          <mat-card class="metric-card" *ngFor="let metric of systemMetrics">
            <div class="metric-header">
              <div class="metric-info">
                <h3>{{ metric.metricName }}</h3>
                <span class="metric-type">{{ metric.metricType }}</span>
              </div>
              <span class="status-chip" [style.background-color]="getQualityStatusColor(metric.status)" [style.color]="'white'">
                {{ metric.status }}
              </span>
            </div>
            <div class="metric-value">
              <span class="value">{{ metric.currentValue.toFixed(1) }}</span>
              <span class="unit">{{ metric.unit }}</span>
            </div>
            <div class="metric-thresholds">
              <div class="threshold warning">
                <span>Warning:</span>
                <span>{{ metric.threshold.warning }}{{ metric.unit }}</span>
              </div>
              <div class="threshold critical">
                <span>Critical:</span>
                <span>{{ metric.threshold.critical }}{{ metric.unit }}</span>
              </div>
            </div>
            <div class="metric-trend">
              <mat-icon [ngClass]="metric.trend">
                {{ metric.trend === 'up' ? 'trending_up' : metric.trend === 'down' ? 'trending_down' : 'trending_flat' }}
              </mat-icon>
              <span>{{ metric.trend }}</span>
              <span class="last-updated">Updated {{ formatDate(metric.lastUpdated) }}</span>
            </div>
            <div class="metric-chart">
              <div class="chart-bar" *ngFor="let point of metric.historicalData" 
                   [style.height.%]="(point.value / metric.threshold.critical) * 100"
                   [matTooltip]="point.value.toFixed(1) + metric.unit">
              </div>
            </div>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Data Quality Tab -->
    <mat-tab label="Data Quality">
      <div class="tab-content">
        <div class="quality-grid">
          <mat-card class="quality-card" *ngFor="let metric of dataQualityMetrics">
            <div class="quality-header">
              <h3>{{ metric.dataSource }}</h3>
              <span class="status-chip" [style.background-color]="getQualityStatusColor(metric.status)" [style.color]="'white'">
                {{ metric.status }}
              </span>
            </div>
            <div class="quality-dimension">
              <mat-icon>{{ metric.qualityDimension === 'completeness' ? 'check_circle' : 
                             metric.qualityDimension === 'accuracy' ? 'verified' :
                             metric.qualityDimension === 'consistency' ? 'sync' : 'schedule' }}</mat-icon>
              <span>{{ metric.qualityDimension | titlecase }}</span>
            </div>
            <div class="quality-score">
              <div class="score-circle" [style.background]="'conic-gradient(#f5576c ' + metric.score + '%, #e5e7eb ' + metric.score + '%)'">
                <div class="score-inner">
                  <span>{{ metric.score.toFixed(1) }}</span>
                </div>
              </div>
            </div>
            <div class="quality-details">
              <div class="detail-row">
                <span>Total Records:</span>
                <strong>{{ formatNumber(metric.details.totalRecords) }}</strong>
              </div>
              <div class="detail-row">
                <span>Valid Records:</span>
                <strong>{{ formatNumber(metric.details.validRecords) }}</strong>
              </div>
              <div class="detail-row">
                <span>Issues:</span>
                <strong class="issues">{{ metric.issues }}</strong>
              </div>
              <div class="detail-row" *ngIf="metric.details.missingFields.length > 0">
                <span>Missing Fields:</span>
                <div class="missing-fields">
                  <span class="field-chip" *ngFor="let field of metric.details.missingFields">{{ field }}</span>
                </div>
              </div>
            </div>
            <div class="quality-footer">
              <mat-icon>schedule</mat-icon>
              <span>Last checked: {{ formatDate(metric.lastChecked) }}</span>
            </div>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- API Health Tab -->
    <mat-tab label="API Health">
      <div class="tab-content">
        <div class="api-grid">
          <mat-card class="api-card" *ngFor="let endpoint of apiEndpoints">
            <div class="api-header">
              <div class="api-method" [ngClass]="endpoint.method.toLowerCase()">
                {{ endpoint.method }}
              </div>
              <div class="api-info">
                <h3>{{ endpoint.endpointName }}</h3>
                <code>{{ endpoint.path }}</code>
              </div>
              <span class="status-chip" [style.background-color]="getStatusColor(endpoint.status)" [style.color]="'white'">
                {{ endpoint.status }}
              </span>
            </div>
            <div class="api-metrics">
              <div class="api-metric">
                <div class="metric-label">Response Time</div>
                <div class="metric-value">{{ endpoint.averageResponseTime.toFixed(0) }}ms</div>
              </div>
              <div class="api-metric">
                <div class="metric-label">Success Rate</div>
                <div class="metric-value success">{{ formatPercentage(endpoint.successRate) }}</div>
              </div>
              <div class="api-metric">
                <div class="metric-label">Error Rate</div>
                <div class="metric-value error">{{ formatPercentage(endpoint.errorRate) }}</div>
              </div>
              <div class="api-metric">
                <div class="metric-label">Requests</div>
                <div class="metric-value">{{ formatNumber(endpoint.requestCount) }}</div>
              </div>
            </div>
            <div class="api-footer">
              <mat-icon>schedule</mat-icon>
              <span>Last request: {{ formatDate(endpoint.lastRequest) }}</span>
            </div>
            <div class="api-errors" *ngIf="endpoint.recentErrors.length > 0">
              <div class="errors-header">
                <mat-icon>error</mat-icon>
                <span>Recent Errors ({{ endpoint.recentErrors.length }})</span>
              </div>
              <div class="error-item" *ngFor="let error of endpoint.recentErrors.slice(0, 3)">
                <span class="error-code">{{ error.statusCode }}</span>
                <span class="error-message">{{ error.errorMessage }}</span>
                <span class="error-time">{{ formatDate(error.timestamp) }}</span>
              </div>
            </div>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Operational Metrics Tab -->
    <mat-tab label="Operational Metrics">
      <div class="tab-content">
        <div class="operational-grid">
          <mat-card class="operational-card" *ngFor="let metric of operationalMetrics">
            <div class="operational-header">
              <h3>{{ metric.metricName }}</h3>
              <mat-icon [ngClass]="metric.status">
                {{ metric.status === 'positive' ? 'trending_up' : 
                   metric.status === 'negative' ? 'trending_down' : 'remove' }}
              </mat-icon>
            </div>
            <div class="operational-value">
              <span class="current">{{ metric.currentValue }}</span>
              <span class="unit">{{ metric.unit }}</span>
            </div>
            <div class="operational-change" [ngClass]="metric.status">
              <mat-icon>{{ metric.trend === 'up' ? 'arrow_upward' : metric.trend === 'down' ? 'arrow_downward' : 'remove' }}</mat-icon>
              <span>{{ metric.changePercent > 0 ? '+' : '' }}{{ metric.changePercent.toFixed(1) }}%</span>
              <span class="vs-previous">vs {{ metric.previousValue }}{{ metric.unit }}</span>
            </div>
          </mat-card>
        </div>
      </div>
    </mat-tab>

    <!-- Alerts Tab -->
    <mat-tab label="Alerts">
      <div class="tab-content">
        <!-- Filters -->
        <mat-card class="filters-card">
          <div class="filters-header">
            <mat-icon>filter_list</mat-icon>
            <h3>Filter Alerts</h3>
          </div>
          <form [formGroup]="filterForm" class="filters-form">
            <div class="form-row">
              <mat-form-field appearance="outline">
                <mat-label>Search</mat-label>
                <input matInput formControlName="search" placeholder="Alert ID, title, message...">
                <mat-icon matPrefix>search</mat-icon>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Severity</mat-label>
                <mat-select formControlName="severity" placeholder="All severities">
                  <mat-option value="">All Severities</mat-option>
                  <mat-option value="info">Info</mat-option>
                  <mat-option value="warning">Warning</mat-option>
                  <mat-option value="critical">Critical</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Alert Type</mat-label>
                <mat-select formControlName="alertType" placeholder="All types">
                  <mat-option value="">All Types</mat-option>
                  <mat-option value="system">System</mat-option>
                  <mat-option value="database">Database</mat-option>
                  <mat-option value="api">API</mat-option>
                  <mat-option value="security">Security</mat-option>
                  <mat-option value="performance">Performance</mat-option>
                </mat-select>
              </mat-form-field>

              <mat-form-field appearance="outline">
                <mat-label>Status</mat-label>
                <mat-select formControlName="status" placeholder="All statuses">
                  <mat-option value="">All Statuses</mat-option>
                  <mat-option value="active">Active</mat-option>
                  <mat-option value="acknowledged">Acknowledged</mat-option>
                  <mat-option value="resolved">Resolved</mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="form-row">
              <div class="date-range" formGroupName="dateRange">
                <mat-form-field appearance="outline">
                  <mat-label>Start Date</mat-label>
                  <input matInput [matDatepicker]="startPicker" formControlName="start" placeholder="Start Date">
                  <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                  <mat-datepicker #startPicker></mat-datepicker>
                </mat-form-field>

                <mat-form-field appearance="outline">
                  <mat-label>End Date</mat-label>
                  <input matInput [matDatepicker]="endPicker" formControlName="end" placeholder="End Date">
                  <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                  <mat-datepicker #endPicker></mat-datepicker>
                </mat-form-field>
              </div>

              <button mat-raised-button color="accent" (click)="resetFilters()" type="button">
                <mat-icon>clear</mat-icon>
                Reset
              </button>
            </div>
          </form>
        </mat-card>

        <!-- Alerts Table -->
        <mat-card class="table-card">
          <table mat-table [dataSource]="displayedAlerts" class="alerts-table">
            <!-- Timestamp Column -->
            <ng-container matColumnDef="timestamp">
              <th mat-header-cell *matHeaderCellDef>Timestamp</th>
              <td mat-cell *matCellDef="let alert">
                <div class="timestamp-cell">
                  <div class="time">{{ formatDate(alert.timestamp) }}</div>
                </div>
              </td>
            </ng-container>

            <!-- Severity Column -->
            <ng-container matColumnDef="severity">
              <th mat-header-cell *matHeaderCellDef>Severity</th>
              <td mat-cell *matCellDef="let alert">
                <span class="severity-chip" [style.background-color]="getSeverityColor(alert.severity)" [style.color]="'white'">
                  {{ alert.severity }}
                </span>
              </td>
            </ng-container>

            <!-- Alert Type Column -->
            <ng-container matColumnDef="alertType">
              <th mat-header-cell *matHeaderCellDef>Type</th>
              <td mat-cell *matCellDef="let alert">
                <div class="alert-type-cell">
                  <mat-icon>{{ alert.alertType === 'system' ? 'computer' :
                                 alert.alertType === 'database' ? 'storage' :
                                 alert.alertType === 'api' ? 'api' :
                                 alert.alertType === 'security' ? 'security' : 'speed' }}</mat-icon>
                  <span>{{ alert.alertType }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Title Column -->
            <ng-container matColumnDef="title">
              <th mat-header-cell *matHeaderCellDef>Alert</th>
              <td mat-cell *matCellDef="let alert">
                <div class="alert-title-cell">
                  <div class="title">{{ alert.title }}</div>
                  <div class="message">{{ alert.message }}</div>
                </div>
              </td>
            </ng-container>

            <!-- Resources Column -->
            <ng-container matColumnDef="resources">
              <th mat-header-cell *matHeaderCellDef>Affected Resources</th>
              <td mat-cell *matCellDef="let alert">
                <div class="resource-list">
                  <span class="resource-chip" *ngFor="let resource of alert.affectedResources">{{ resource }}</span>
                </div>
              </td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let alert">
                <div class="status-indicator">
                  <span *ngIf="alert.resolved" class="status-badge resolved">Resolved</span>
                  <span *ngIf="!alert.resolved && alert.acknowledged" class="status-badge acknowledged">Acknowledged</span>
                  <span *ngIf="!alert.resolved && !alert.acknowledged" class="status-badge active">Active</span>
                </div>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let alert">
                <button mat-icon-button [matMenuTriggerFor]="actionsMenu" type="button">
                  <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #actionsMenu="matMenu">
                  <button mat-menu-item (click)="openAlertDialog(alert)" *ngIf="!alert.acknowledged" type="button">
                    <mat-icon>check</mat-icon>
                    <span>Acknowledge</span>
                  </button>
                  <button mat-menu-item (click)="resolveAlert(alert)" *ngIf="!alert.resolved" type="button">
                    <mat-icon>done_all</mat-icon>
                    <span>Resolve</span>
                  </button>
                  <button mat-menu-item (click)="deleteAlert(alert)" type="button">
                    <mat-icon>delete</mat-icon>
                    <span>Delete</span>
                  </button>
                </mat-menu>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <mat-paginator
            [length]="filteredAlerts.length"
            [pageSize]="pageSize"
            [pageIndex]="pageIndex"
            [pageSizeOptions]="pageSizeOptions"
            (page)="onPageChange($event)">
          </mat-paginator>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Predictive Analytics Tab -->
    <mat-tab label="Predictive Analytics">
      <div class="tab-content">
        <!-- Analytics Summary -->
        <div class="predictive-summary">
          <mat-card class="summary-card">
            <div class="card-icon primary">
              <mat-icon>trending_up</mat-icon>
            </div>
            <div class="card-content">
              <h3>Predictions</h3>
              <div class="big-number">{{ predictiveAnalytics.predictions.length }}</div>
              <div class="card-subtitle">Metric Forecasts</div>
            </div>
          </mat-card>

          <mat-card class="summary-card">
            <div class="card-icon accent">
              <mat-icon>warning</mat-icon>
            </div>
            <div class="card-content">
              <h3>Anomalies</h3>
              <div class="big-number">{{ predictiveAnalytics.anomalies.length }}</div>
              <div class="card-subtitle">Detected Issues</div>
            </div>
          </mat-card>

          <mat-card class="summary-card">
            <div class="card-icon success">
              <mat-icon>lightbulb</mat-icon>
            </div>
            <div class="card-content">
              <h3>Recommendations</h3>
              <div class="big-number">{{ predictiveAnalytics.recommendations.length }}</div>
              <div class="card-subtitle">Action Items</div>
            </div>
          </mat-card>

          <mat-card class="summary-card">
            <div class="card-icon info">
              <mat-icon>verified</mat-icon>
            </div>
            <div class="card-content">
              <h3>Confidence</h3>
              <div class="big-number">{{ predictiveAnalytics.confidenceScore }}%</div>
              <div class="card-subtitle">Analysis Accuracy</div>
            </div>
          </mat-card>
        </div>

        <!-- Predictions Section -->
        <mat-card class="predictions-card" *ngIf="predictiveAnalytics.predictions.length > 0">
          <div class="section-header">
            <mat-icon>trending_up</mat-icon>
            <h3>Metric Predictions (Next 30 Minutes)</h3>
          </div>
          <div class="predictions-grid">
            <div class="prediction-item" *ngFor="let prediction of predictiveAnalytics.predictions" 
                 [class.critical]="prediction.willExceedThreshold"
                 (click)="openPredictionDetails(prediction)">
              <div class="prediction-header">
                <h4>{{ prediction.metricName }}</h4>
                <span class="confidence-badge">{{ prediction.confidence }}% confidence</span>
              </div>
              <div class="prediction-values">
                <div class="value-item">
                  <span class="label">Current</span>
                  <span class="value">{{ prediction.currentValue.toFixed(1) }}</span>
                </div>
                <mat-icon class="arrow-icon">arrow_forward</mat-icon>
                <div class="value-item">
                  <span class="label">Predicted</span>
                  <span class="value">{{ prediction.predictedValue.toFixed(1) }}</span>
                </div>
              </div>
              <div class="prediction-trend">
                <mat-icon [style.color]="prediction.trend === 'increasing' ? '#ef4444' : prediction.trend === 'decreasing' ? '#10b981' : '#6b7280'">
                  {{ prediction.trend === 'increasing' ? 'trending_up' : prediction.trend === 'decreasing' ? 'trending_down' : 'trending_flat' }}
                </mat-icon>
                <span>{{ prediction.trend | titlecase }}</span>
              </div>
              <div class="prediction-alert" *ngIf="prediction.willExceedThreshold">
                <mat-icon>warning</mat-icon>
                <span>Will exceed threshold in {{ prediction.timeToThreshold }} minutes</span>
              </div>
            </div>
          </div>
        </mat-card>

        <!-- Anomalies Section -->
        <mat-card class="anomalies-card" *ngIf="predictiveAnalytics.anomalies.length > 0">
          <div class="section-header">
            <mat-icon>warning</mat-icon>
            <h3>Detected Anomalies</h3>
          </div>
          <div class="anomalies-list">
            <div class="anomaly-item" *ngFor="let anomaly of predictiveAnalytics.anomalies"
                 [class.high-severity]="anomaly.severity === 'high'"
                 (click)="openAnomalyDetails(anomaly)">
              <div class="anomaly-header">
                <span class="severity-badge" [style.background-color]="getAnomalySeverityColor(anomaly.severity)">
                  {{ anomaly.severity | uppercase }}
                </span>
                <h4>{{ anomaly.metricName }}</h4>
                <span class="anomaly-type">{{ anomaly.anomalyType.replace('_', ' ') | titlecase }}</span>
              </div>
              <p class="anomaly-description">{{ anomaly.description }}</p>
              <div class="anomaly-stats">
                <div class="stat">
                  <span class="label">Expected</span>
                  <span class="value">{{ anomaly.expectedValue }}</span>
                </div>
                <div class="stat">
                  <span class="label">Actual</span>
                  <span class="value">{{ anomaly.actualValue }}</span>
                </div>
                <div class="stat">
                  <span class="label">Deviation</span>
                  <span class="value">{{ anomaly.deviationPercentage }}%</span>
                </div>
              </div>
              <div class="potential-causes">
                <strong>Potential Causes:</strong>
                <ul>
                  <li *ngFor="let cause of anomaly.potentialCauses">{{ cause }}</li>
                </ul>
              </div>
            </div>
          </div>
        </mat-card>

        <!-- Recommendations Section -->
        <mat-card class="recommendations-card" *ngIf="predictiveAnalytics.recommendations.length > 0">
          <div class="section-header">
            <mat-icon>lightbulb</mat-icon>
            <h3>AI-Powered Recommendations</h3>
          </div>
          <div class="recommendations-list">
            <div class="recommendation-item" *ngFor="let rec of predictiveAnalytics.recommendations">
              <div class="recommendation-header">
                <span class="priority-badge" [style.background-color]="getRecommendationPriorityColor(rec.priority)">
                  {{ rec.priority | uppercase }}
                </span>
                <span class="category-badge">{{ rec.category | titlecase }}</span>
              </div>
              <h4>{{ rec.title }}</h4>
              <p class="recommendation-description">{{ rec.description }}</p>
              <div class="recommendation-details">
                <div class="detail-item">
                  <mat-icon>impact</mat-icon>
                  <div>
                    <strong>Impact:</strong>
                    <p>{{ rec.impact }}</p>
                  </div>
                </div>
                <div class="detail-item">
                  <mat-icon>schedule</mat-icon>
                  <div>
                    <strong>Estimated Effort:</strong>
                    <p>{{ rec.estimatedEffort }}</p>
                  </div>
                </div>
                <div class="detail-item" *ngIf="rec.potentialSavings">
                  <mat-icon>savings</mat-icon>
                  <div>
                    <strong>Potential Savings:</strong>
                    <p>{{ rec.potentialSavings }}</p>
                  </div>
                </div>
              </div>
              <div class="implementation-steps">
                <strong>Implementation Steps:</strong>
                <ol>
                  <li *ngFor="let step of rec.implementationSteps">{{ step }}</li>
                </ol>
              </div>
              <button mat-raised-button color="primary" type="button">
                <mat-icon>check_circle</mat-icon>
                Implement
              </button>
            </div>
          </div>
        </mat-card>

        <!-- Threshold Configuration Section -->
        <mat-card class="threshold-config-card">
          <div class="section-header">
            <mat-icon>tune</mat-icon>
            <h3>Alert Threshold Configuration</h3>
            <button mat-raised-button color="accent" (click)="openThresholdConfig()" type="button">
              <mat-icon>settings</mat-icon>
              Configure Thresholds
            </button>
          </div>
          <p>Customize warning and critical thresholds for each metric to receive timely alerts.</p>
        </mat-card>
      </div>
    </mat-tab>

    <!-- Historical Analysis Tab -->
    <mat-tab label="Historical Analysis">
      <div class="tab-content">
        <!-- Period Selector -->
        <div class="period-selector">
          <button 
            mat-raised-button 
            [class.active]="historicalAnalytics.selectedPeriod === '7days'"
            (click)="changeHistoricalPeriod('7days')">
            Last 7 Days
          </button>
          <button 
            mat-raised-button 
            [class.active]="historicalAnalytics.selectedPeriod === '30days'"
            (click)="changeHistoricalPeriod('30days')">
            Last 30 Days
          </button>
          <button 
            mat-raised-button 
            [class.active]="historicalAnalytics.selectedPeriod === '90days'"
            (click)="changeHistoricalPeriod('90days')">
            Last 90 Days
          </button>
          <button mat-button (click)="exportHistoricalData('csv')">
            <mat-icon>download</mat-icon>
            Export CSV
          </button>
          <button mat-button (click)="exportHistoricalData('json')">
            <mat-icon>download</mat-icon>
            Export JSON
          </button>
        </div>

        <!-- Summary Cards -->
        <div class="historical-summary">
          <mat-card class="summary-card">
            <div class="card-icon trends">
              <mat-icon>show_chart</mat-icon>
            </div>
            <div class="card-content">
              <div class="big-number">{{ historicalAnalytics.trends.length }}</div>
              <div class="card-subtitle">Metrics Tracked</div>
            </div>
          </mat-card>

          <mat-card class="summary-card">
            <div class="card-icon improved">
              <mat-icon>trending_up</mat-icon>
            </div>
            <div class="card-content">
              <div class="big-number">{{ historicalAnalytics.topImprovedMetrics.length }}</div>
              <div class="card-subtitle">Improved Metrics</div>
            </div>
          </mat-card>

          <mat-card class="summary-card">
            <div class="card-icon degraded">
              <mat-icon>trending_down</mat-icon>
            </div>
            <div class="card-content">
              <div class="big-number">{{ historicalAnalytics.topDegradedMetrics.length }}</div>
              <div class="card-subtitle">Degraded Metrics</div>
            </div>
          </mat-card>

          <mat-card class="summary-card">
            <div class="card-icon comparisons">
              <mat-icon>compare_arrows</mat-icon>
            </div>
            <div class="card-content">
              <div class="big-number">{{ historicalAnalytics.comparisons.length }}</div>
              <div class="card-subtitle">Period Comparisons</div>
            </div>
          </mat-card>
        </div>

        <!-- Trends Section -->
        <mat-card class="trends-card" *ngIf="historicalAnalytics.trends.length > 0">
          <div class="section-header">
            <mat-icon>show_chart</mat-icon>
            <h3>Historical Trends</h3>
          </div>

          <div class="trends-grid">
            <div class="trend-item" *ngFor="let trend of historicalAnalytics.trends" (click)="openTrendDetails(trend)">
              <div class="trend-header">
                <h4>{{ trend.metricName }}</h4>
                <mat-icon [style.color]="getTrendColor(trend.trendDirection)">
                  {{ getTrendIcon(trend.trendDirection) }}
                </mat-icon>
              </div>

              <div class="trend-stats">
                <div class="stat">
                  <span class="label">Average</span>
                  <span class="value">{{ trend.averageValue }}%</span>
                </div>
                <div class="stat">
                  <span class="label">Min</span>
                  <span class="value">{{ trend.minValue }}%</span>
                </div>
                <div class="stat">
                  <span class="label">Max</span>
                  <span class="value">{{ trend.maxValue }}%</span>
                </div>
              </div>

              <div class="trend-change" [style.color]="getTrendColor(trend.trendDirection)">
                <mat-icon>{{ getTrendIcon(trend.trendDirection) }}</mat-icon>
                <span>{{ trend.changePercentage > 0 ? '+' : '' }}{{ trend.changePercentage }}%</span>
                <span class="change-label">{{ trend.period === '7days' ? '7-day' : trend.period === '30days' ? '30-day' : '90-day' }} change</span>
              </div>

              <div class="data-points-preview">
                <div 
                  class="point" 
                  *ngFor="let point of trend.dataPoints.slice(-20)"
                  [class.healthy]="point.status === 'healthy'"
                  [class.warning]="point.status === 'warning'"
                  [class.critical]="point.status === 'critical'"
                  [style.height.%]="(point.value / trend.maxValue) * 100">
                </div>
              </div>
            </div>
          </div>
        </mat-card>

        <!-- Comparisons Section -->
        <mat-card class="comparisons-card" *ngIf="historicalAnalytics.comparisons.length > 0">
          <div class="section-header">
            <mat-icon>compare_arrows</mat-icon>
            <h3>Period-over-Period Comparisons</h3>
          </div>

          <div class="comparisons-list">
            <div class="comparison-item" *ngFor="let comparison of historicalAnalytics.comparisons" (click)="openComparisonDetails(comparison)">
              <div class="comparison-header">
                <h4>{{ comparison.metricName }}</h4>
                <div class="improvement-badge" [class.improved]="comparison.improvement" [class.degraded]="!comparison.improvement">
                  <mat-icon>{{ comparison.improvement ? 'arrow_downward' : 'arrow_upward' }}</mat-icon>
                  <span>{{ comparison.improvement ? 'Improved' : 'Degraded' }}</span>
                </div>
              </div>

              <div class="comparison-values">
                <div class="period-value">
                  <span class="period-label">Current Period</span>
                  <span class="value-large">{{ comparison.currentPeriod.averageValue }}%</span>
                  <span class="value-range">{{ comparison.currentPeriod.lowestValue }}% - {{ comparison.currentPeriod.peakValue }}%</span>
                </div>

                <div class="comparison-arrow">
                  <mat-icon [style.color]="comparison.improvement ? '#10b981' : '#ef4444'">
                    {{ comparison.percentageChange > 0 ? 'trending_up' : 'trending_down' }}
                  </mat-icon>
                  <span class="change-percent" [style.color]="comparison.improvement ? '#10b981' : '#ef4444'">
                    {{ comparison.percentageChange > 0 ? '+' : '' }}{{ comparison.percentageChange }}%
                  </span>
                </div>

                <div class="period-value">
                  <span class="period-label">Previous Period</span>
                  <span class="value-large">{{ comparison.previousPeriod.averageValue }}%</span>
                  <span class="value-range">{{ comparison.previousPeriod.lowestValue }}% - {{ comparison.previousPeriod.peakValue }}%</span>
                </div>
              </div>
            </div>
          </div>
        </mat-card>

        <!-- Top Metrics Section -->
        <div class="top-metrics-section">
          <mat-card class="top-metrics-card improved-card" *ngIf="historicalAnalytics.topImprovedMetrics.length > 0">
            <div class="section-header">
              <mat-icon>emoji_events</mat-icon>
              <h3>Most Improved Metrics</h3>
            </div>

            <div class="metrics-list">
              <div class="metric-item" *ngFor="let metric of historicalAnalytics.topImprovedMetrics; let i = index">
                <div class="rank">{{ i + 1 }}</div>
                <div class="metric-info">
                  <span class="metric-name">{{ metric.metricName }}</span>
                  <div class="improvement-bar">
                    <div class="bar-fill improved" [style.width.%]="metric.improvement"></div>
                  </div>
                </div>
                <div class="metric-value improved">
                  <mat-icon>arrow_downward</mat-icon>
                  <span>{{ metric.improvement.toFixed(1) }}%</span>
                </div>
              </div>
            </div>
          </mat-card>

          <mat-card class="top-metrics-card degraded-card" *ngIf="historicalAnalytics.topDegradedMetrics.length > 0">
            <div class="section-header">
              <mat-icon>warning</mat-icon>
              <h3>Most Degraded Metrics</h3>
            </div>

            <div class="metrics-list">
              <div class="metric-item" *ngFor="let metric of historicalAnalytics.topDegradedMetrics; let i = index">
                <div class="rank">{{ i + 1 }}</div>
                <div class="metric-info">
                  <span class="metric-name">{{ metric.metricName }}</span>
                  <div class="improvement-bar">
                    <div class="bar-fill degraded" [style.width.%]="metric.degradation"></div>
                  </div>
                </div>
                <div class="metric-value degraded">
                  <mat-icon>arrow_upward</mat-icon>
                  <span>{{ metric.degradation.toFixed(1) }}%</span>
                </div>
              </div>
            </div>
          </mat-card>
        </div>
      </div>
    </mat-tab>

  </mat-tab-group>
</div>

<!-- Trend Details Dialog -->
<div class="dialog-overlay" *ngIf="showHistoricalDialog" (click)="closeHistoricalDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()" *ngIf="selectedTrend">
    <div class="dialog-header">
      <h2>{{ selectedTrend.metricName }} - Trend Details</h2>
      <button mat-icon-button (click)="closeHistoricalDialog()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="dialog-body">
      <div class="trend-summary">
        <div class="summary-stat">
          <mat-icon>analytics</mat-icon>
          <div>
            <span class="stat-label">Average Value</span>
            <span class="stat-value">{{ selectedTrend.averageValue }}%</span>
          </div>
        </div>
        <div class="summary-stat">
          <mat-icon>arrow_downward</mat-icon>
          <div>
            <span class="stat-label">Minimum</span>
            <span class="stat-value">{{ selectedTrend.minValue }}%</span>
          </div>
        </div>
        <div class="summary-stat">
          <mat-icon>arrow_upward</mat-icon>
          <div>
            <span class="stat-label">Maximum</span>
            <span class="stat-value">{{ selectedTrend.maxValue }}%</span>
          </div>
        </div>
        <div class="summary-stat">
          <mat-icon [style.color]="getTrendColor(selectedTrend.trendDirection)">
            {{ getTrendIcon(selectedTrend.trendDirection) }}
          </mat-icon>
          <div>
            <span class="stat-label">Trend</span>
            <span class="stat-value" [style.color]="getTrendColor(selectedTrend.trendDirection)">
              {{ selectedTrend.trendDirection | titlecase }}
            </span>
          </div>
        </div>
      </div>

      <div class="data-points-table">
        <h4>Historical Data Points (Last 50)</h4>
        <div class="table-scroll">
          <table>
            <thead>
              <tr>
                <th>Timestamp</th>
                <th>Value</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let point of selectedTrend.dataPoints.slice(-50).reverse()">
                <td>{{ point.timestamp | date:'short' }}</td>
                <td>{{ point.value }}%</td>
                <td>
                  <span class="status-badge" [class]="point.status">
                    {{ point.status | titlecase }}
                  </span>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Comparison Details Dialog -->
<div class="dialog-overlay" *ngIf="showComparisonDialog" (click)="closeComparisonDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()" *ngIf="selectedComparison">
    <div class="dialog-header">
      <h2>{{ selectedComparison.metricName }} - Comparison Details</h2>
      <button mat-icon-button (click)="closeComparisonDialog()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="dialog-body">
      <div class="comparison-overview">
        <div class="overview-badge" [class.improved]="selectedComparison.improvement" [class.degraded]="!selectedComparison.improvement">
          <mat-icon>{{ selectedComparison.improvement ? 'check_circle' : 'warning' }}</mat-icon>
          <span>{{ selectedComparison.improvement ? 'Performance Improved' : 'Performance Degraded' }}</span>
          <span class="change-value">{{ selectedComparison.percentageChange > 0 ? '+' : '' }}{{ selectedComparison.percentageChange }}%</span>
        </div>
      </div>

      <div class="periods-comparison">
        <div class="period-details">
          <h4>Current Period</h4>
          <div class="period-info">
            <div class="info-item">
              <span class="label">Date Range</span>
              <span class="value">{{ selectedComparison.currentPeriod.startDate | date:'short' }} - {{ selectedComparison.currentPeriod.endDate | date:'short' }}</span>
            </div>
            <div class="info-item">
              <span class="label">Average Value</span>
              <span class="value highlighted">{{ selectedComparison.currentPeriod.averageValue }}%</span>
            </div>
            <div class="info-item">
              <span class="label">Peak Value</span>
              <span class="value">{{ selectedComparison.currentPeriod.peakValue }}%</span>
            </div>
            <div class="info-item">
              <span class="label">Lowest Value</span>
              <span class="value">{{ selectedComparison.currentPeriod.lowestValue }}%</span>
            </div>
          </div>
        </div>

        <div class="comparison-divider">
          <mat-icon [style.color]="selectedComparison.improvement ? '#10b981' : '#ef4444'">
            {{ selectedComparison.percentageChange > 0 ? 'trending_up' : 'trending_down' }}
          </mat-icon>
        </div>

        <div class="period-details">
          <h4>Previous Period</h4>
          <div class="period-info">
            <div class="info-item">
              <span class="label">Date Range</span>
              <span class="value">{{ selectedComparison.previousPeriod.startDate | date:'short' }} - {{ selectedComparison.previousPeriod.endDate | date:'short' }}</span>
            </div>
            <div class="info-item">
              <span class="label">Average Value</span>
              <span class="value highlighted">{{ selectedComparison.previousPeriod.averageValue }}%</span>
            </div>
            <div class="info-item">
              <span class="label">Peak Value</span>
              <span class="value">{{ selectedComparison.previousPeriod.peakValue }}%</span>
            </div>
            <div class="info-item">
              <span class="label">Lowest Value</span>
              <span class="value">{{ selectedComparison.previousPeriod.lowestValue }}%</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Alert Dialog (existing) -->
<div class="dialog-overlay" *ngIf="showAlertDialog" (click)="closeAlertDialog()">
  <div class="dialog-content" (click)="$event.stopPropagation()">
    <div class="dialog-header">
      <h2>{{ isEditMode ? 'Alert Details' : 'Add New Alert' }}</h2>
      <button mat-icon-button (click)="closeAlertDialog()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="dialog-body">
      <div class="alert-details" *ngIf="isEditMode && selectedAlert">
        <div class="detail-row">
          <strong>Alert ID:</strong>
          <span>{{ selectedAlert.id }}</span>
        </div>
        <div class="detail-row">
          <strong>Created:</strong>
          <span>{{ selectedAlert.timestamp | date:'medium' }}</span>
        </div>
        <div class="detail-row">
          <strong>Severity:</strong>
          <span class="severity-badge" [class]="selectedAlert.severity">
            {{ selectedAlert.severity | uppercase }}
          </span>
        </div>
        <div class="detail-row">
          <strong>Type:</strong>
          <span>{{ selectedAlert.alertType | titlecase }}</span>
        </div>
        <div class="detail-row">
          <strong>Status:</strong>
          <span class="status-chip" [class]="selectedAlert.resolved ? 'resolved' : selectedAlert.acknowledged ? 'acknowledged' : 'active'">
            {{ selectedAlert.resolved ? 'Resolved' : selectedAlert.acknowledged ? 'Acknowledged' : 'Active' }}
          </span>
        </div>
        <div class="detail-row">
          <strong>Affected Resources:</strong>
          <div class="resources-list">
            <span class="resource-chip" *ngFor="let resource of selectedAlert.affectedResources">
              {{ resource }}
            </span>
          </div>
        </div>

        <div class="alert-message">
          <strong>Message:</strong>
          <p>{{ selectedAlert.message }}</p>
        </div>

        <div *ngIf="selectedAlert.acknowledged" class="acknowledgment-info">
          <strong>Acknowledged By:</strong>
          <p>{{ selectedAlert.acknowledgedBy }} at {{ selectedAlert.acknowledgedAt | date:'medium' }}</p>
        </div>
      </div>

      <div class="alert-form" *ngIf="!isEditMode">
        <form [formGroup]="alertForm">
          <mat-form-field appearance="outline">
            <mat-label>Title</mat-label>
            <input matInput formControlName="title" placeholder="Enter alert title">
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Message</mat-label>
            <textarea matInput formControlName="message" rows="3" placeholder="Enter alert message"></textarea>
          </mat-form-field>

          <mat-form-field appearance="outline">
            <mat-label>Notes</mat-label>
            <textarea matInput formControlName="notes" rows="3" placeholder="Additional notes..."></textarea>
          </mat-form-field>
        </form>
      </div>

      <div class="dialog-actions">
        <button mat-button (click)="closeAlertDialog()" type="button">Cancel</button>
        <button mat-raised-button color="primary" (click)="acknowledgeAlert()" type="button">
          Acknowledge
        </button>
      </div>
    </div>
  </div>
</div>
